/*
 * Project:    RXX - NDB Logging Database
 * Homepage:   https://rxx.classaxe.com
 * Version:    2.21.3
 * Date:       2020-12-13
 * Licence:    LGPL
 * Copyright:  2020 Martin Francis
 */
var gridColor="#808080",gridOpacity=.5,highlight,layers={grid:[]},map,markers=[],all_sections=[],award={},cart=[],popWinSpecs={"admin_users_[id]":"width=420,height=320,status=1,scrollbars=1,resizable=1",admin_users_new:"width=420,height=320,status=1,scrollbars=1,resizable=1","countries_*":"width=860,height=630,resizable=1",countries_af:"width=640,height=630,resizable=1",countries_as:"width=780,height=590,resizable=1",countries_eu:"width=680,height=590,resizable=1",countries_na:"width=640,height=220,resizable=1",countries_oc:"width=680,height=500,resizable=1",countries_sa:"width=320,height=600,resizable=1","listeners_[id]":"width=1000,height=760,status=1,scrollbars=1,resizable=1","listeners_[id]_logs":"width=1000,height=760,status=1,scrollbars=1,resizable=1","listeners_[id]_upload":"width=1000,height=760,status=1,scrollbars=1,resizable=1","listeners_[id]_signals":"width=1000,height=760,status=1,scrollbars=1,resizable=1","listeners_[id]_map":"width=1000,height=760,status=1,scrollbars=1,resizable=1","listeners_[id]_locatormap":"width=1000,height=760,status=1,scrollbars=1,resizable=1","[id]_signals_map":"width=1000,height=760,status=1,scrollbars=1,resizable=1","listeners_[id]_ndbweblog":"status=1,scrollbars=1,resizable=1","logs_[id]":"width=640,height=500,status=1,scrollbars=1,resizable=1",maps_af:"width=646,height=652,resizable=1",maps_alaska:"width=600,height=620,resizable=1",maps_as:"width=856,height=645,resizable=1",maps_au:"width=511,height=545,resizable=1",maps_eu:"width=704,height=760,resizable=1",maps_japan:"width=517,height=740,resizable=1",maps_na:"width=669,height=720,resizable=1",maps_pacific:"width=600,height=750,resizable=1",maps_polynesia:"width=500,height=525,resizable=1",maps_sa:"width=490,height=745,resizable=1",signals_new:"width=720,height=320,status=1,scrollbars=1,resizable=1","signals_[id]":"width=1040,height=800,status=1,scrollbars=1,resizable=1","signals_[id]_logs":"width=1040,height=800,status=1,scrollbars=1,resizable=1","signals_[id]_listeners":"width=1040,height=800,status=1,scrollbars=1,resizable=1","signals_[id]_map":"width=1040,height=800,status=1,scrollbars=1,resizable=1","signals_[id]_weather":"width=1040,height=800,status=1,scrollbars=1,resizable=1","states_*":"width=720,height=760,resizable=1",states_aus:"width=720,height=240,resizable=1",states_can_usa:"width=680,height=690,resizable=1",tools_coordinates:"width=900,height=195,resizable=1",tools_dgps:"width=720,height=345,resizable=1",tools_navtex:"width=420,height=580,resizable=1",tools_negativeKeyer:"width=800,height=560,resizable=1",tools_references:"width=520,height=130,resizable=1",tools_sunrise:"width=520,height=385,resizable=1",weather_aurora_n:"width=520,height=580,resizable=1",weather_aurora_s:"width=520,height=580,resizable=1",weather_lightning:"width=620,height=620,resizable=1"},awards={all_sections:[],init:function(t){var e,o;for(e in awards.all_sections=t,awards.all_sections)o=awards.all_sections[e],$("#toggle_"+o).css({cursor:"pointer"}).prop("title",msg.show_hide).click(function(){$("#"+this.id.replace("toggle_","")).toggle(),$(this).find("span").toggle()}).find("span").css({"font-size":"120%"});$("#all_0").click(function(){return awards.toggleSections(0),!1}),$("#all_1").click(function(){return awards.toggleSections(1),!1}),$("#form_email").change(function(){isValidEmail($("#form_email").val())?$("#form_submit").removeAttr("disabled"):$("#form_submit").attr("disabled","disabled")}),$("#form_done").click(function(){location.replace(location.protocol+"//"+location.host+location.pathname)}),$("#form_body").val(msg.cart_none),$(".cart").each(function(){$(this).html('<span><img src="'+base_image+'/icon_cart.gif" alt="'+msg.no+'" title=""/><img style="display: none" src="'+base_image+'/icon_cart_added.gif" alt="'+msg.yes+'" /></span>')}),$(".cart span").click(function(){var t=$(this).parent(),e=t.attr("id");awards.toggleAward(e),t.find("img").toggle()}),$("#form_submit").click(function(){var t=msg.cart_conf_1+"\n"+msg.cart_conf_2+"\n\n"+msg.cart_conf_3+"\n"+msg.cart_conf_4;if(!confirm(t))return alert(msg.cancelled),!1})},toggleAward:function(t){var o,e,n,i;if(-1===(n=$.inArray(t,cart))?cart.push(t):cart.splice(n,1),cart=cart.sort(),i=msg.cart_none,cart.length){for(e in o=[],cart)o.push(cart[e].split("-")[0]);o=$.grep(o,function(t,e){return $.inArray(t,o)===e}),i=msg.cart_1+"\n"+msg.cart_2.padEnd(8," ")+award.admin+"\n"+msg.cart_3.padEnd(8," ")+award.from+"\n"+msg.cart_4.padEnd(8," ")+award.url+"/"+o.join(",")+"\n\n"+msg.cart_5+"\n"+msg.cart_6+"\n\n * "+cart.join("\n * ")+"\n\n"+msg.cart_7+"\n"+award.name}$("#form_awards").val(cart.join(",")),$("#form_filter").val(o.join(",")),$("#form_body").val(i),cart.length&&isValidEmail($("#form_email").val())?$("#form_submit").removeAttr("disabled"):$("#form_submit").attr("disabled","disabled")},toggleSections:function(t){var e,o,n;for(e in awards.all_sections)o=$("#"+awards.all_sections[e]),n=$("#toggle_"+awards.all_sections[e]),t?(o.show(),n.find("span:eq(0)").hide(),n.find("span:eq(1)").show()):(o.hide(),$sectionToggle.find("span:eq(0)").show(),n.find("span:eq(1)").hide())}},cle={init:function(){$("#toggle_editor").css({cursor:"pointer"}).prop("title",msg.show_hide).click(function(){$("#"+this.id.replace("toggle_","")).toggle(),$(this).find("span").toggle()}).find("span").css({"font-size":"120%"}),$.datepicker.setDefaults({changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",yearRange:"2010:+1"}),$(".js-datepicker").datepicker({}),tinymce.init({selector:"textarea",height:150,menubar:!1,plugins:["advlist autolink lists link image charmap print preview anchor textcolor colorpicker","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste code wordcount"],toolbar:"insert | undo redo | formatselect | bold italic forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | code | help"}),$('td input[type="checkbox"]').click(function(){var e=[],t=$(this).parent().parent().find("input:hidden");$(this).parent().parent().find("input:checkbox:checked").each(function(){var t="type_"+$(this).parent().prop("className").split("_")[1].toUpperCase()+"=1";e.push(t)}),t.val(e.join("&amp;"))}),cle.setTypes(),setExternalLinks()},setTypes:function(){var t,e,o,n;for(t in e=["#form_worldRange1Type","#form_worldRange2Type","#form_europeRange1Type","#form_europeRange2Type"])""!==(n=$(e[t]).val())&&(o=n.split("&amp;"),$(e[t]).parent().find("input:checkbox").each(function(){var t,e;for($(this).prop("checked",!1),t=0;t<o.length;t++)e="type_"+o[t].split("_")[1].split("=")[0].toLowerCase(),$(this).parent().prop("className")===e&&$(this).prop("checked","checked")}))}};function changeShowMode(t){$("#form_show").val(t),formSubmit()}function decodeHtmlEntities(t){return $("<div/>").html(t).text()}function getMetar(t){window.open("https://www.aviationweather.gov/metar/data?ids="+$("#form_icao").val()+"&format="+(t?"decoded":"raw")+"&taf=on&layout=off&hours="+$("#form_hours").val(),"popMETAR"+t,"scrollbars=1,resizable=1,location=1")}function isValidEmail(t){return/^([\w-.]+@([\w-]+\.)+[\w-]{2,4})?$/.test(t)}function popup(t){var e,o,n,i,a,s,r=[];for(s=t.split("/").reverse(),o=0;o<=2;o++)$.isNumeric(s[o])?(n=s[o],r.push("[id]")):r.push(s[o]);return-1!==["rna","reu","rww"].indexOf(r[2])&&r.pop(),r.reverse(),i=r.join("_").replace(",","_").split("?")[0],void 0===popWinSpecs[i]?(alert("Unhandled mode "+i),!1):(a=i.replace("[id]",n),(e=window.open(t,a,popWinSpecs[i]))?e.focus():alert("ERROR:\n\nThis site tried to open a popup window\nbut was prevented from doing so.\n\nPlease disable any popup blockers you may\nhave enabled for this site."),!1)}function scrollToResults(){""!==$("#form_show").val()&&$([document.documentElement,document.body]).animate({scrollTop:$("#tabs").offset().top-20},500)}function setClippedCellTitles(){$("td.clipped").each(function(){$(this).attr("title",$(this).text().trim())})}function setColumnSortActions(){$("table.results thead tr th[id]").each(function(){$(this).click(function(){var t=this.id.split("|")[0],e=this.id.split("|")[1],o=$("#form_order");$(this).hasClass("sorted")&&(e="a"===o.val()?"d":"a"),$("#form_sort").val(t),o.val(e),$('form[name="form"]').submit()})})}function setColumnSortedClass(){$("table.results thead tr th").each(function(){this.id.split("|")[0]===$("#form_sort").val()&&($(this).append("d"===$("#form_order").val()?" &#9662;":" &#9652;"),$(this).addClass("sorted"))})}function setEmailLinks(){$("a[data-contact]").each(function(){var t=$(this).attr("data-contact").split("").reverse().join("").trim().replace("#","@");$(this).attr("href",t),$(this).removeAttr("data-contact")})}function setEqualHeight(t,e){if(!$(t).height())return window.setTimeout(function(){setEqualHeight(t,e)},100);$(e).height($(t).height()),$(e).show(),$(e).height($(t).height())}function setExternalLinks(){$('a[rel="external"]').attr("target","_blank"),$("a[data-popup]").click(function(){if(1===$(this).data("popup"))return popup(this.href);var t=$(this).data("popup").split("|");return window.open(this.href,t[0],t[1]),!1}),$("a[data-append]").click(function(){var e,t,o,n;return e=$(this).find("span").html(),t="itu"===$(this).data("append")?"#form_countries":"#form_states",n=(o=window.opener.$(t)).val().split(" "),-1!==$.inArray(e,n)?n=n.filter(function(t){return t!==e}):n.push(e),o.val(Array.from(new Set(n)).sort().join(" ").trim()),!1}).attr("title",msg.data_append),$("a[data-set]").click(function(){var t,e,o,n;switch(t=$(this).text(),$(this).data("set")){case"khz":e=["#form_khz_1","#form_khz_2"];break;case"itu":e=["#form_countries"];break;case"sp":e=["#form_states"]}for(n in e)(o=$(e[n])).val()===t?o.val(""):o.val(t);return $('form[name="form"]').submit(),!1}).attr("title",msg.data_set),$("a.close").click(function(){$(this).parent().hide()}),$("a[data-gsq]").click(function(){var t="map_"+$(this).data("gsq");return window.open(this.href,t,"scrollbars=1,resizable=1,width=1024,height=800"),!1}).each(function(){$(this).attr("href","./signals/"+$(this).data("gsq")+"/map")}).attr("title",msg.s_map_eu).attr("class","hover"),$("a[data-signal-map-eu]").click(function(){var t="map_"+$(this).data("signal-map-eu");return window.open(this.href,t,"scrollbars=1,resizable=1,width=1040,height=800"),!1}).each(function(){$(this).attr("href","./signals/"+$(this).data("signal-map-eu")+"/map/eu")}).attr("title",msg.s_map_eu).attr("class","hover"),$("a[data-signal-map-na]").click(function(){var t="map_"+$(this).data("signal-map-na");return window.open(this.href,t,"scrollbars=1,resizable=1,width=1040,height=800"),!1}).each(function(){$(this).attr("href","./signals/"+$(this).data("signal-map-na")+"/map/na")}).attr("title",msg.s_map_na).attr("class","hover")}function setFormCollapseSections(){$("#section_loggings legend").click(function(){$(this).parent().find("fieldset").toggle(),$(this).parent().find("fieldset fieldset").toggle(),$(this).find("span").toggle()}),$("#section_customise legend").click(function(){$(this).parent().find("fieldset").toggle(),$(this).parent().find("fieldset fieldset").toggle(),$(this).find("span").toggle()})}function setFormCountryAction(t){(t=void 0===t||t)?$("select#form_country").change(function(){formSubmit()}):$("select#form_country").off("change")}function setFormCountriesLabelLink(){var t=$('label[for="form_countries"]');t.html('<a href="countries/*" data-popup="1">'+t.html()+"</a>")}function setFormStatesLabelLink(){var t=$('label[for="form_states"]');t.html('<a href="states/*" data-popup="1">'+t.html()+"</a>")}function setFormDatePickers(){$.datepicker.setDefaults({changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",yearRange:"1970:+0"}),$(".js-datepicker").datepicker({})}function setFormHeardInModDefault(){0===$("fieldset#form_heard_in_mod div :radio:checked").length&&$('fieldset#form_heard_in_mod div :radio[value="any"]').prop("checked",!0)}function setFormListenerInvertDefault(){0===$("fieldset#form_listener_invert div :radio:checked").length&&$("fieldset#form_listener_invert div :radio[value=0]").prop("checked",!0)}function setFormListenerOptionsStyle(){$("#form_listener").children().each(function(){""===$(this).val()?$(this).addClass("all"):". "===$(this).text().substr(0,2)?($(this).text("Â "+$(this).text().substr(1)),$(this).addClass("secondaryQth")):$(this).addClass("primaryQth")})}function setFormPagingActions(){var t=$("#form_filter"),e=$("#form_prev"),o=$("#form_next"),n=$("#form_limit"),a=$("#form_page");n.length&&(n[0].outerHTML='<select id="form_limit" name="form[limit]" required="required">'+getLimitOptions(paging.total,n.val(),paging.limit)+"</select>",n=$("#form_limit")),a.length&&(a[0].outerHTML='<label class="sr-only" for="form_page">Page Control</label>\n<select id="form_page" name="form[page]" style="display:none">'+getPagingOptions(paging.total,n.val(),paging.page)+"</select>",a=$("#form_page"));var i=$("#form_page option");"-1"!==n.val()&&(e.show(),o.show(),a.show()),n.change(function(){var t=$('form[name="form"]'),e=$("#form_limit"),o=$("#form_page option"),n=$("#form_prev"),i=$("#form_next");o.eq(0).prop("selected",!0),a.prop("selectedIndex",0),"-1"!==e.val()?(n.show(),i.show(),a.show(),o.eq(0).prop("text","1-"+e.val()),n.prop("disabled","disabled"),i.prop("disabled","disabled")):(a.hide(),n.hide(),i.hide()),a.prop("selectedIndex",0),t.submit()}),0<paging.page?e.click(function(){var t=$('form[name="form"]'),e=$("#form_page"),o=$("#form_page option"),n=$("#form_prev"),i=$("#form_next");return n.prop("disabled","disabled"),i.prop("disabled","disabled"),o.eq(paging.page-1).prop("selected",!0),e.prop("selectedIndex",paging.page-1),t.submit(),!1}):e.prop("disabled","disabled"),paging.page+1<i.length?o.click(function(){var t=$('form[name="form"]'),e=$("#form_page"),o=$("#form_page option"),n=$("#form_prev"),i=$("#form_next");return n.prop("disabled","disabled"),i.prop("disabled","disabled"),o.eq(paging.page+1).prop("selected",!0),e.prop("selectedIndex",paging.page+1),t.submit(),!1}):o.prop("disabled","disabled"),a.change(function(){var t=$('form[name="form"]'),e=$("#form_prev"),o=$("#form_next");e.prop("disabled","disabled"),o.prop("disabled","disabled"),t.submit()}),t.change(function(){var t=$('form[name="form"]'),e=$("#form_page"),o=$("#form_page option"),n=$("#form_prev"),i=$("#form_next");o.eq(0).prop("selected",!0),e.prop("selectedIndex",0),n.prop("disabled","disabled"),i.prop("disabled","disabled"),t.submit()})}function copyToClipboard(t){var e=$("<textarea>");$("body").append(e),e.val(t).select(),document.execCommand("copy"),e.remove()}function setFormPagingStatus(t,e){$("#form_paging_status").html(t.replace("%s",e.toLocaleString()))}function setFormPersonaliseAction(t){(t=void 0===t||t)?$("#form_personalise").change(function(){var t=$("#form_personalise option:selected").text(),e=(2===t.split("|").length?t.split("|")[1]:"").trim(),o=$("#form_range_gsq");o.val(e),o.trigger("keyup"),$('form[name="form"]').submit()}):$("#form_personalise").off("change")}function setFormOffsetsAction(t){(t=void 0===t||t)?$("#form_offsets").change(function(){formSubmit()}):$("#form_offsets").off("change")}function setFormRangeAction(){var t=$("#form_range_gsq"),e=$("#form_range_min");t.on("keyup",function(){var t=$("#form_range_gsq").val().length<6;$("#form_range_min").attr("disabled",t),$("#form_range_max").attr("disabled",t)}),e.on("keyup",function(){var t=0===$("#form_range_min").val().length&&0===$("#form_range_max").val().length;$("#form_range_units").attr("disabled",t)}),$("#form_dx_max").on("keyup",function(){var t=0===$("#form_range_min").val().length&&0===$("#form_range_max").val().length;$("#form_range_units").attr("disabled",t)}),t.trigger("keyup"),e.trigger("keyup")}function setFormRangeUnitsDefault(){0===$("fieldset#form_range_units div :radio:checked").length&&$("fieldset#form_range_units div :radio[value=km]").prop("checked",!0)}function setFormAdminAction(t){(t=void 0===t||t)?$("select#form_admin_mode").change(function(){formSubmit()}):$("select#form_admin_mode").off("change")}function setFormHasLogsAction(t){(t=void 0===t||t)?$("select#form_has_logs").change(function(){formSubmit()}):$("select#form_has_logs").off("change")}function setFormTimezoneAction(t){(t=void 0===t||t)?$("#form_timezone").on("selectmenuchange",function(){formSubmit()}):$("#form_timezone").off("selectmenuchange")}function setFormHasMapPosAction(t){(t=void 0===t||t)?$("select#form_has_map_pos").change(function(){formSubmit()}):$("select#form_has_map_pos").off("change")}function setFormRegionAction(t){(t=void 0===t||t)?$("select#form_region").change(function(){formSubmit()}):$("select#form_region").off("change")}function setFormRwwFocusAction(t){(t=void 0===t||t)?$("select#form_rww_focus").change(function(){formSubmit()}):$("select#form_rww_focus").off("change")}function setFormResetAction(t){var e=$('button[type="reset"]');switch(t){case"signals":e.click(function(){var t=$("#form_range_gsq"),e=$("#form_range_min");return setFormAdminAction(!1),setFormRegionAction(!1),setFormRwwFocusAction(!1),setFormOffsetsAction(!1),setFormPersonaliseAction(!1),$("#form_show").val(""),$("#form_types div :checkbox").prop("checked",!1),$("#form_types div :checkbox[value=NDB]").prop("checked",!0),$("#form_call").val(""),$("#form_khz_1").val(""),$("#form_khz_2").val(""),$("#form_channels").prop("selectedIndex",0),$("#form_active").prop("selectedIndex",0),$("#form_personalise").prop("selectedIndex",0),$("#form_offsets").prop("selectedIndex",0),$("#form_states").val(""),$("#form_sp_itu_clause").prop("selectedIndex",0),$("#form_countries").val(""),$("#form_region").prop("selectedIndex",0),$("#form_rww_focus").prop("selectedIndex",0),$("#form_gsq").val(""),t.val(""),e.val(""),$("#form_range_max").val(""),$("#form_range_units_0").prop("checked",1),t.trigger("keyup"),e.trigger("keyup"),$("#form_listener").val([]),$("#form_listener_invert_0").prop("checked",1),$("#form_heard_in").val(""),$("#form_heard_in_mod_0").prop("checked",1),$("#form_logged_date_1").val(""),$("#form_logged_date_2").val(""),$("#form_logged_first_1").val(""),$("#form_logged_first_2").val(""),$("#form_logged_last_1").val(""),$("#form_logged_last_2").val(""),$("#form_admin_mode").prop("selectedIndex",0),setFormPersonaliseAction(!0),setFormOffsetsAction(!0),setFormAdminAction(!0),setFormRegionAction(!0),setFormRwwFocusAction(!0),formSubmit(),!1});break;case"listeners":e.click(function(){return $("fieldset#form_types div :checkbox").prop("checked",!1),$("fieldset#form_types div :checkbox[value=NDB]").prop("checked",!0),$("#form_filter").val(""),setFormCountryAction(!1),setFormRegionAction(!1),setFormRwwFocusAction(!1),setFormHasLogsAction(!1),setFormHasMapPosAction(!1),setFormTimezoneAction(!1),$("select#form_region").prop("selectedIndex",0),$("select#form_country").prop("selectedIndex",0),$("select#form_has_map_pos").prop("selectedIndex",0),$("select#form_timezone").val("").selectmenu("refresh"),setFormCountryAction(!0),setFormRegionAction(!0),setFormRwwFocusAction(!0),setFormHasLogsAction(!0),setFormHasMapPosAction(!0),setFormTimezoneAction(!0),formSubmit(),!1})}}function formSubmit(){$("#form_clear").prop("disabled","disabled"),$("#form_submit").click().prop("disabled","disabled")}function setFormShowModeAction(){$("#seeklist_paper").change(function(){$("#form_paper").val($("#seeklist_paper option:selected").val()),formSubmit()})}function setFormSortbyAction(){$("select#form_sortby").change(function(){var t=$("#form_sortby option:selected").val();$("#form_sort").val(t.split("|")[0]),$("#form_order").val(t.split("|")[1]),$("#form_za").prop("checked","d"===t.split("|")[1]),formSubmit()})}function setFormSortZaAction(){$("input#form_za").change(function(){$("#form_order").val($("input#form_za").prop("checked")?"d":"a"),formSubmit()})}function setFormTypesStyles(){$("fieldset#form_type div input").each(function(){$(this).parent().attr("class","type_"+$(this).attr("class"))})}function setFormTypesDefault(){0===$("fieldset#form_type div :checkbox:checked").length&&$("fieldset#form_type div :checkbox[value=NDB]").prop("checked",!0)}function setFormTypesAllAction(){$("fieldset#form_type div :checkbox[value=ALL]").click(function(){$("fieldset#form_type div :checkbox").prop("checked",$(this).prop("checked"))})}function setFocusOnCall(){var t=$("#form_call");t.focus(),t.select()}function strip_tags(t,o){return o=(((o||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join(""),t.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(t,e){return-1<o.indexOf("<"+e.toLowerCase()+">")?t:""})}function lead(t,e){for(var o=String(t);o.length<(e||2);)o="0"+o;return o}function pad(t,e,o){var n=(String(t)+"                                        ").substr(0,e);return"string"==typeof o?n.replace(/ /g,o):n}Number.prototype.numberFormat=function(t,e,o){var n;return e=void 0!==e?e:".",o=void 0!==o?o:",",(n=this.toFixed(t).split("."))[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,o),n.join(e)};var LMap={markerGroups:null,init:function(){map=new google.maps.Map($("#map").get(0),{center:{lat:center.lat,lng:center.lon},scaleControl:!0,zoomControl:!0,zoom:7}),box[0].lat===box[1].lat&&box[0].lon===box[1].lon||map.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(box[0].lat,box[0].lon),new google.maps.LatLng(box[1].lat,box[1].lon))),LMap.drawGrid(),LMap.drawMarkers(),LMap.setActions(),setExternalLinks(),setClippedCellTitles()},drawGrid:function(){return drawGrid(map,layers)},drawMarkers:function(){var t,e,o,n,i,a;if(listeners){for(e in LMap.markerGroups=new google.maps.MVCObject,LMap.markerGroups.set("primary",map),LMap.markerGroups.set("secondary",map),LMap.markerGroups.set("highlight",map),n={url:base_image+"/map_point3.gif",origin:new google.maps.Point(0,0),anchor:new google.maps.Point(5,5)},i={url:base_image+"/map_point4.gif",origin:new google.maps.Point(0,0),anchor:new google.maps.Point(5,5)},o={url:base_image+"/map_point_here.gif",origin:new google.maps.Point(0,0),anchor:new google.maps.Point(6,6)},t="",listeners)l=listeners[e],t+='<tr id="listener_'+l.id+'" class="qth_'+(l.pri?"pri":"sec")+'" data-gmap="'+l.lat+"|"+l.lon+'"><td class="text-nowrap"><img style="display:block;float: left" src="'+base_image+"/map_point"+(l.pri?3:4)+'.gif" alt="'+(l.pri?msg.qth_pri:msg.qth_sec)+'" /><a href="'+base_url+"listeners/"+l.id+'" class="'+(l.pri?"pri":"sec")+'" data-popup="1">'+l.name+"</a></td><td>"+l.qth+"</td><td>"+l.sp+"</td><td>"+l.itu+"</td></tr>",(a=new google.maps.Marker({id:"point_"+l.id,icon:l.pri?n:i,position:new google.maps.LatLng(l.lat,l.lon),title:decodeHtmlEntities(l.name)+": "+decodeHtmlEntities(l.qth)+(l.sp?", "+l.sp:"")+", "+l.itu})).bindTo("map",LMap.markerGroups,l.pri?"primary":"secondary"),markers.push(a);for(e in markers)markers[e].addListener("mouseover",function(){$("#listener_"+this.id.split("_")[1]).css("background","#ffff00")}),markers[e].addListener("mouseout",function(){$("#listener_"+this.id.split("_")[1]).css("background","")}),markers[e].addListener("click",function(){$("#listener_"+this.id.split("_")[1]).find("a").trigger("click")});$(".results tbody").append(t),$("tr[data-gmap]").mouseover(function(){var t=$(this).data("gmap").split("|");highlight=new google.maps.Marker({position:new google.maps.LatLng(t[0],t[1]),map:map,icon:o})}).mouseout(function(){highlight.setMap(null)}),$(".no-results").hide(),$(".results").show()}},setActions:function(){$("#layer_grid").click(function(){var t,e;for(e in t=$("#layer_grid").prop("checked"),layers.grid)layers.grid[e].setMap(t?map:null)}),$("#layer_primary").click(function(){var t=$("#layer_primary");LMap.markerGroups.set("primary",t.prop("checked")?map:null),t.prop("checked")?$("#markerlist .qth_pri").show():$("#markerlist .qth_pri").hide()}),$("#layer_secondary").click(function(){var t=$("#layer_secondary");LMap.markerGroups.set("secondary",t.prop("checked")?map:null),t.prop("checked")?$("#markerlist .qth_sec").show():$("#markerlist .qth_sec").hide()})}};function initListenersForm(t,e){$(document).ready(function(){setFormPagingActions(),setFormTypesStyles(),setFormTypesDefault(),$("#form_timezone").selectmenu(),setFormTypesAllAction(),setFormCountryAction(),setFormRegionAction(),setFormHasLogsAction(),setFormHasLogsAction(),setFormHasMapPosAction(),setFormTimezoneAction(),setFormResetAction("listeners"),setColumnSortActions(),setColumnSortedClass(),setFocusOnSearch(),setExternalLinks(),setFormPagingStatus(t,e),setListenerActions(),scrollToResults(),RT.init($("#wide"),$("#narrow"))})}function setFocusOnSearch(){var t=$("#form_q");t.focus(),t.select()}function setListenerActions(){$("#btn_prt").click(function(){return window.print(),!1}),$("#btn_share").click(function(){return shareListeners(),!1}),$("#btn_new").click(function(){return window.open("./listeners/new","listener_new",popWinSpecs["listeners_[id]"]),!1})}var LocatorMap={init:function(o,n){var t=$("#rx_map");if(!t.height())return window.setTimeout(function(){LocatorMap.init(o,n)},100);t.on("click",function(){var t=parseInt(e.pageX-$(this).offset().left),o=parseInt(e.pageY-$(this).offset().top);LocatorMap.setPos(t,o),$("#form_mapX").val(t),$("#form_mapY").val(o)}),$("#form_mapX").change(function(){o=parseInt($("#form_mapX").val()),n=parseInt($("#form_mapY").val()),LocatorMap.setPos(o,n)}),$("#form_mapY").change(function(){o=parseInt($("#form_mapX").val()),n=parseInt($("#form_mapY").val()),LocatorMap.setPos(o,n)}),$("#x_sub").click(function(){var t=$("#form_mapX"),e=parseInt(t.val());0<e&&t.val(e-1).trigger("change")}),$("#x_add").click(function(){var t=$("#form_mapX"),e=parseInt(t.val());t.val(e+1).trigger("change")}),$("#y_sub").click(function(){var t=$("#form_mapY"),e=parseInt(t.val());0<e&&t.val(e-1).trigger("change")}),$("#y_add").click(function(){var t=$("#form_mapY"),e=parseInt(t.val());t.val(e+1).trigger("change")}),$("#form_reset").click(function(t){t.preventDefault(),form=t.toElement.form,form.reset(),o=$("#form_mapX").val(),n=$("#form_mapY").val(),LocatorMap.setPos(o,n)}),LocatorMap.setPos(o,n),$("#form").show()},setPos:function(t,e){0===t&&0===e||$("#cursor").css({left:t-10+"px",top:e-10+"px",display:"block"})}};function initListenersLogUploadForm(){var o={pskov:"  DD.MM.YYYY  hhmm  KHZ    ID    LSB    USB    sec            X",wwsu:"YYYY-MM-DD UTC    KHZ     ID         X       QTH",yand:"YYYYMMDD hhmm KHZ ID   X          QTH           X"},t=$("#form_format");for(var s in t.on("keyup",function(){$("#form_saveFormat").attr("disabled",$(this).val()===$("#formatOld").text())}),window.performance&&window.performance.navigation.type===window.performance.navigation.TYPE_BACK_FORWARD&&t.trigger("keyup"),o)!function(t){$("#format_"+t).on("click",function(){$("#form_format").val(o[t])})}(s);$("#form_saveFormat").on("click",function(){!1!==confirm(msg.log_upload.prompt.a)?$("#form_step").val("1b"):e.preventDefault()}),$("#form_tabs2spaces").on("click",function(){var t=$("#form_logs");t.val(t.val().replace(/\t/g,"     "))}),$("#form_lineUp").on("click",function(){var t,e,o,n,i,a,s,r,l,c;for(e in format=$("#form_format"),a=0,l=[],n=(i=$("#form_logs")).val().split("\n"))a<(c=(o=n[e].replace(/^\s+|\s+$/g,"").replace(/\s+/g," ")).split(" ").length)&&(a=c),n[e]=o;for(t=0;t<a;t++)l[t]=0;for(e in n)for(r in c=(o=n[e]).split(" "))(s=c[r]).length>l[r]&&(l[r]=s.length);for(e in n){for(r in c=(o=n[e]).split(" "))s=c[r],c[r]=s.padEnd(l[r]+1," ");n[e]=c.join("")}i.val(n.join("\r\n"))}),$("#form_parseLog").on("click",function(t){var e,o,n;for(e in n=[["#form_format",3,4],["#form_logs",5,6],["#form_YYYY",7,8],["#form_MM",9,10],["#form_DD",11,12]],logsRemoveBlankLines($("#form_logs")),n)if((o=$(n[e][0])).is(":visible")&&(""===o.val()||o.val()===msg["log_upload_"+n[e][2]]))return t.preventDefault(),o.val(msg["log_upload_"+n[e][2]]),alert(msg.error.toUpperCase()+"\n\n"+msg["log_upload_"+n[e][1]]),o.focus().select(),!1;$("#form_selected").val("UNSET"),$("#form_step").val(2)}),$("#form_back").on("click",function(){$("#form_step").val(1),$("#form_selected").val("UNSET")}),$(document).on("click",".tokensHelpLink",function(){return $(this).addClass("on"),$(this).tooltip({content:$("#tokensHelp").html(),items:".tokensHelpLink.on",position:{my:"left+15 top-20",at:"right center"},tooltipClass:"toolTipDetails"}),$(this).trigger("mouseenter"),$(".tokensHelp b").on("click",function(){var t=$(this).text();copyToClipboard(t),alert(msg.copied_x.replace("%s",t))}).attr("title",msg.copy_token),$(".tokensHelp #tokensHelpClose").on("click",function(){return $(".tokensHelpLink").removeClass("on").tooltip("close"),!1}),!1}),$(document).on("click",".tokensHelpLink.on",function(){return $(this).removeClass("on"),$(this).tooltip("close"),!1}),$(".tokensHelpLink").on("mouseout",function(t){t.stopImmediatePropagation()}),$("table.parse").on("click","tr td:gt(1)",function(t){t.stopImmediatePropagation();var e=$(this).parent().find("input:checkbox");e.prop("checked",!e.prop("checked")),e.trigger("change")}),$("table.parse input:checkbox").change(function(){$('input[data-idx="'+$(this).data().idx+'"]').not(this).prop("checked",!1),logsShowRemainder()}),$("#form_submitLog").on("click",function(t){var e=msg.log_upload.confirm,o=$("#remainder_logs").val(),n=0,i=[];if(""!==o)for(s in i=o.split("\n"))""!==i[s]&&"* "!==i[s].substr(0,2)&&n++;var a=n?e[1]+"\n"+e[2].replace("COUNT",n)+"\n\n"+e[3]:e[1];if(!confirm(a))return t.preventDefault(),!1;$("#form_step").val(3)}),$("#copyDetails").on("click",function(){var t=($("#remainder_format").val()+"\n"+$("#remainder_logs").val()).split("\n");return len=1+t.sort(function(t,e){return e.length-t.length})[0].length,copyToClipboard($("#logEmail").val()+"\n"+"-".repeat(len)+"\n"+$("#remainder_format").val()+"\n"+"-".repeat(len)+"\n"+$("#remainder_logs").val().trimEnd()+"\n"+"-".repeat(len)+"\n\n"),alert(msg.log_upload.copy_remaining),!1}),$("#copyEmail").on("click",function(){var t=($("#remainder_format").val()+"\n"+$("#remainder_logs").val()).split("\n");return len=1+t.sort(function(t,e){return e.length-t.length})[0].length,copyToClipboard("To:       "+$("#logEmail").val()+"\nSubject:  Issues seen for log upload for "+$("#logOwner").val()+"\n\n\nDear Listener,\n\nSome potential issues were encountered when attempting to upload a submitted log.\nWould you please check the following log entries?\n\n"+"-".repeat(len)+"\n"+$("#remainder_format").val()+"\n"+"-".repeat(len)+"\n"+$("#remainder_logs").val().trimEnd()+"\n"+"-".repeat(len)+"\n\n\n\nSincerely,\n\n\n"+$("#userName").val()),alert(msg.log_upload.prepare_email),!1}),$(".jump .up").on("click",function(){var t=parseInt($(this).parent().attr("id").split("_")[1]),e=$("#jump_"+(t-1)).parent().attr("id").split("_")[1];document.getElementById("row_"+(e-1)).scrollIntoView({behavior:"smooth",block:"start"})}),$(".jump .down").on("click",function(){var t=parseInt($(this).parent().attr("id").split("_")[1]),e=$("#jump_"+(t+1));if(e.length){var o=e.parent().attr("id").split("_")[1];document.getElementById("row_"+(o-1)).scrollIntoView({behavior:"smooth",block:"start"})}else alert(msg.log_upload.last_item)}),$("#check_good").on("click",function(){return $("table.parse .good input:checkbox").each(function(){$(this).prop("checked",!0)}),logsShowRemainder(),!1}),$("#check_warning").on("click",function(){return $("table.parse .warning input:checkbox").each(function(){$(this).prop("checked",!0)}),logsShowRemainder(),!1}),$("#check_choice").on("click",function(){var t,e,o;for(t=$("table.parse .choice input:checkbox"),o=[],e=0;e<t.length;e++){var n=$(t[e]).data("idx");void 0===o[n]&&(o[n]=0),$(t[e]).parent().parent().hasClass("inactive")||o[n]++}for(e=0;e<o.length;e++)1===o[e]&&$("tr:not(.inactive) input[type=checkbox][data-idx="+e+"]").prop("checked","checked");return logsShowRemainder(),!1}),$("#uncheck_warning").on("click",function(){return $("table.parse .warning input:checkbox").each(function(){$(this).prop("checked",!1)}),logsShowRemainder(),!1}),$("#uncheck_choice").on("click",function(){return $("table.parse .choice input:checkbox").each(function(){$(this).prop("checked",!1)}),logsShowRemainder(),!1}),$("#uncheck_all").on("click",function(){return $("table.parse input:checkbox").each(function(){$(this).prop("checked",!1)}),logsShowRemainder(),!1})}function logsRemoveBlankLines(t){var e,o,n;for(o=t.val().split("\n"),n=[],e=0;e<o.length;e++)""!==o[e].trim()&&n.push(o[e]);t.val(n.join("\n"))}function logsShowRemainder(){var t,e,o,n=$("#form_logs").val().split("\n"),i=[],a=[],s=[];for(t in $("table.parse input:checkbox").each(function(){$(this).is(":checked")&&(a.push($(this).val()),o=$(this).val().split("|")[0],i[o]=o)}),i)i.hasOwnProperty(t)&&(n[t]="");for(t in n)if(n.hasOwnProperty(t)){if(""===n[t])continue;if("* "===n[t].substr(0,2))continue;e=$("#row_"+t).data("issues"),s.push(n[t]+(e?"\n* ISSUES: "+e+"\n":""))}$("#remainder_format").val($("#form_format").val()),$("#remainder_logs").val(s.join("\r\n")),$("#form_selected").val(a.join(",")),$("#issueCount").text(s.length)}var LOG_EDIT={init:function(){$("#form_save").on("click",function(){$("#form_reload").val(1)}),$("#form_saveClose").on("click",function(){$("#form_reload").val(1),$("#form__close").val(1)}),LOG_EDIT.initListenersSelector(listeners),LOG_EDIT.initSignalsSelector(signals),LOG_EDIT.initTimeControl(),setFormDatePickers()},initListenersSelector:function(t){var e,o,n,i,a;for(o in a=(e=$("#form_listenerId")).val(),n='<select id="form_listenerId" name="form[listenerId]" required="required" size="10">\n',t)n+="<option value='"+(i=t[o].split("|"))[0]+"' data-gsq='"+i[3]+"' data-tz='"+i[8]+"' class='"+("1"===i[4]?"primaryQth":"secondaryQth")+"'"+(i[0]===a?" selected='selected'":"")+">"+pad(i[1]+", "+i[5]+(i[2]?" "+i[2]:""),"1"===i[4]?60:58,"&nbsp;")+(i[6]?" "+i[6]:"&nbsp; &nbsp;")+" "+i[7]+"</option>";n+="</select>",e.replaceWith(n),$("#form_listenerId").on("change",function(){LOG_EDIT.getDx(),LOG_EDIT.getDaytime()})},initSignalsSelector:function(t){var e,o,n,i,a;for(o in a=(e=$("#form_signalId")).val(),n='<select id="form_signalId" name="form[signalId]" required="required" size="10">\n',t)n+="<option value='"+(i=t[o].split("|"))[0]+"'"+("0"===i[5]?" title='"+msg.inactive+"'":"")+" class='type_"+i[3]+("0"===i[5]?" inactive":"")+"' data-gsq='"+i[4]+"'"+(i[0]===a?" selected='selected'":"")+">"+pad(parseFloat(i[2]),10,"&nbsp;")+pad(i[1],10,"&nbsp;")+pad(i[6],41,"&nbsp;")+pad(i[7],3,"&nbsp;")+i[8]+" </option>";n+="</select>",e.replaceWith(n),$("#form_signalId").on("change",function(){LOG_EDIT.getDx()})},initTimeControl:function(){element=$("#form_time"),element.on("change",function(){LOG_EDIT.getDaytime()})},getDx:function(){var t,e,o,n,i;if(e=(o=document.getElementById("form_listenerId")).options[o.selectedIndex].getAttribute("data-gsq"),n=(i=document.getElementById("form_signalId")).options[i.selectedIndex].getAttribute("data-gsq"),""===e||""===n)return!1;t=CONVERT.gsq_gsq_dx(e,n),$("#form_dxKm").val(t?t.dx_km:""),$("#form_dxMiles").val(t?t.dx_miles:"")},getDaytime:function(){var t,e,o,n;o=(n=document.getElementById("form_listenerId")).options[n.selectedIndex].getAttribute("data-tz"),e=4===(t=$("#form_time").val()).length&&parseInt(t)+2400>=-100*o+3400&&parseInt(t)+2400<-100*o+3800?1:0,$("#form_daytime").val(e)}};function drawGrid(t,e){var o,n,i;for(TxtOverlay=initMapsTxtOverlay(),n=0;n<180;n+=10)e.grid.push(new google.maps.Polyline({path:[{lat:n-90,lng:-180},{lat:n-90,lng:0},{lat:n-90,lng:180}],geodesic:!1,strokeColor:gridColor,strokeOpacity:gridOpacity,strokeWeight:.5}));for(i=0;i<360;i+=20)e.grid.push(new google.maps.Polyline({path:[{lat:85.05,lng:i},{lat:-85.05,lng:i}],geodesic:!1,strokeColor:gridColor,strokeOpacity:gridOpacity,strokeWeight:.5}));for(n=10;n<170;n+=10)for(i=0;i<360;i+=20)e.grid.push(new TxtOverlay(new google.maps.LatLng(n-90+5,i-180+10),String.fromCharCode(i/20+65)+String.fromCharCode(n/10+65),"gridLabel",t));for(o in e.grid)e.grid[o].setMap(t)}function initMapsTxtOverlay(){function t(t,e,o,n){this.pos=t,this.txt_=e,this.cls_=o,this.map_=n,this.div_=null,this.setMap(n)}return(t.prototype=new google.maps.OverlayView).onAdd=function(){var t,e;(t=document.createElement("DIV")).className=this.cls_,t.innerHTML=this.txt_,this.div_=t,e=this.getProjection().fromLatLngToDivPixel(this.pos),t.style.left=e.x+"px",t.style.top=e.y+"px",this.getPanes().floatPane.appendChild(t)},t.prototype.draw=function(){var t,e;e=this.getProjection().fromLatLngToDivPixel(this.pos),(t=this.div_).style.left=e.x+"px",t.style.top=e.y+"px"},t.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},t}function getLimitOptions(t,e,o){var n=[10,20,50,100,200,500,1e3,2e3,5e3,1e5,2e4,5e4,1e5],i="";for(var a in n)t<n[a]&&o<n[a]||(i+='<option value="'+n[a]+'"'+(parseInt(e)===n[a]?' selected="selected"':"")+">"+n[a]+" results</option>");return i+='<option value="'+(n[0]<t?-1:o)+'"'+(-1===parseInt(e)?' selected="selected"':"")+">All results</option>"}function getPagingOptions(t,e,o){var n="";pages=t/e;for(var i=0;i<pages;i++)n+='<option value="'+i+'"'+(parseInt(o)===i?' selected="selected"':"")+">"+(1+i*e)+"-"+(t<(i+1)*e?t:(i+1)*e)+"</option>";return n}var RT={classes:[],fields:[],preamble:"",rows:[],titles:[],init:function(t,e){this.source=t,this.destination=e,this.readSource(),this.drawMedium(),this.drawNarrow()},drawMedium:function(){var i,a=0;for(i in RT.fields)RT.fields[i].rowspan2?RT.preamble+="th"===RT.fields[i].type?"<th></th>":"<td></td>":a++;i=0,this.source.find("tbody tr").each(function(){var t,e,o,n=$(this);for(o in e="<table>",RT.fields)RT.rows[i][RT.fields[o].idx]&&RT.rows[i][RT.fields[o].idx].l2&&RT.rows[i][RT.fields[o].idx].html&&(t=RT.rows[i][RT.fields[o].idx].class.replace(/( )*l2/gi,""),e+="<tr><th>"+RT.fields[o].html+':</th><td class="'+t+'">'+RT.rows[i][RT.fields[o].idx].html+"</td></tr>");e+="</table>",n.after('<tr class="'+n.prop("class")+' l2_alt">'+RT.preamble+'<td colspan="'+a+'">'+e+"</td></tr>"),i++})},drawNarrow:function(){var t,e,o;for(e in t="",this.rows){for(o in t+='<table class="responsive"><tbody>\n',this.fields)this.rows[e][this.fields[o].idx]&&""!==this.rows[e][this.fields[o].idx].html&&(t+='<tr title="'+this.titles[e]+'"><th>'+this.fields[o].html+'</th><td class="'+this.rows[e][this.fields[o].idx].class+'">'+this.rows[e][this.fields[o].idx].html+"</td></tr>\n");t+="</tbody></table>\n\n"}this.destination.append(t)},readSource:function(){var e=0;this.source.find("thead tr th").each(function(){var t=$(this);t.hasClass("hidden")||(RT.fields.push({idx:e++,html:t.html().trim().split("<br>")[0],l2:t.hasClass("l2"),rowspan2:t.hasClass("rowspan2"),type:t.hasClass("th")?"th":"td"}),RT.classes.push(t.prop("title").trim()),RT.titles.push(t.prop("title").trim()))}),this.source.find("tbody tr").each(function(){var t=$(this),e={title:t.prop("title")},o=0;t.find("th,td").each(function(){var t=$(this);e[RT.fields[o++].idx]={class:t.prop("class"),l2:t.hasClass("l2"),html:t.html().trim()}}),RT.rows.push(e)})}},shareableLink={getBaseUrl:function(t){return window.location.protocol+"//"+window.location.host+base_url+t},getFromField:function(t,e,o){var n=$("#form_"+t).val();return void 0===n||""===n?"":("string"==typeof o&&-1!==$.inArray(o,["a","A"])&&(n="a"===o?n.toLowerCase():n.toUpperCase()),void 0===e||-1!==$.inArray(n,e)?"&"+t+"="+encodeURI(n):"")},getFromListeners:function(){var t=$("#form_listener");return void 0===t.val()||""===encodeURI(t.val())?"":"&listeners="+encodeURI(t.val())},getFromPagingControls:function(t){var e=$("#form_limit"),o=$("#form_page");return(t!==parseInt(e.val())?"&limit="+e.val():"")+(void 0!==o.val()&&null!==o.val()&&0!==parseInt(o.val())?"&page="+o.val():"")},getFromPair:function(t){var e=$("#form_"+t+"_1"),o=$("#form_"+t+"_2");return e.val()||o.val()?"&"+t+"="+encodeURI(e.val())+(e.val()!==o.val()?","+encodeURI(o.val()):""):""},getFromRadioGroup:function(t,e){var o=$("input[name='form["+t+"]']:checked");return void 0!==o.val()&&""!==o.val()&&(void 0===e||-1!==$.inArray(o.val(),e))?"&"+t+"="+encodeURI(o.val()):""},getFromSortingControls:function(t,e){var o=$("#form_sort"),n=$("#form_order");return(t!==o.val()?"&sort="+o.val():"")+(e!==n.val()?"&order="+n.val():"")},getFromTypes:function(){var t=[];return $("fieldset#form_type div input").each(function(){$(this).is(":checked")&&"ALL"!==$(this).prop("value")&&t.push($(this).prop("value"))}),0===t.length&&(t=["NDB"]),7===t.length&&(t=["ALL"]),"?types="+$.uniqueSort(t).join(",")},listenersUrl:function(){return this.getBaseUrl("listeners")+this.getFromTypes()+this.getFromField("q")+this.getFromField("region")+this.getFromField("country")+this.getFromField("has_logs",["N","Y"],"A")+this.getFromField("has_map_pos",["N","Y"],"A")+this.getFromField("timezone")+this.getFromPagingControls(100)+this.getFromSortingControls("name","a")},signalsUrl:function(){return this.getBaseUrl("signals")+this.getFromTypes()+this.getFromField("rww_focus")+this.getFromField("call")+this.getFromPair("khz")+this.getFromField("channels")+this.getFromField("states")+this.getFromField("sp_itu_clause",["or"])+this.getFromField("countries")+this.getFromField("region")+this.getFromField("gsq")+this.getFromField("active")+this.getFromListeners()+this.getFromRadioGroup("listener_invert",["1"])+this.getFromField("heard_in")+this.getFromRadioGroup("heard_in_mod",["all"])+this.getFromPair("logged_date")+this.getFromPair("logged_first")+this.getFromPair("logged_last")+this.getFromPagingControls(50)+this.getFromSortingControls("khz","a")+this.getFromField("personalise")+this.getFromField("offsets",["1"])+this.getFromField("range_gsq")+this.getFromField("range_min")+this.getFromField("range_max")+(this.getFromField("range_gsq")?this.getFromRadioGroup("range_units"):"")+this.getFromRadioGroup("paper",["a4","a4_l","lgl","lgl_l","ltr","ltr_l"])+this.getFromField("admin_mode")}};function shareListeners(){var t=shareableLink.listenersUrl();$("#dialog").html("<p>"+msg.share.listeners.text1+"<br>"+msg.share.listeners.text2+'</p><ul><li><a style="color:#0000ff" href="'+t+'">'+msg.share.listeners.links.list+'</a></li><li><a style="color:#0000ff" href="'+t+'&show=map">'+msg.share.listeners.links.map+"</a></li></ul>").dialog({buttons:[{text:msg.close,click:function(){$(this).dialog("close")}}],open:function(){$(".ui-dialog-buttonpane button").focus()},modal:!0,title:msg.share.listeners.title})}function shareSignals(){var t=shareableLink.signalsUrl();$("#dialog").html('<p style="margin:0">'+msg.share.signals.text1+"<br>"+msg.share.signals.text2+'</p><ul><li><a style="color:#0000ff" href="'+t+'">'+msg.share.signals.links.list+'</a></li><li><a style="color:#0000ff" href="'+t+'&show=seeklist">'+msg.share.signals.links.seeklist+'</a></li><li><a style="color:#0000ff" href="'+t+'&show=map">'+msg.share.signals.links.map+'</a></li></ul><p style="margin:0"><strong>'+msg.share.signals.links.export+'</strong></p><ul style="margin-bottom:0"><li><a style="color:#0000ff" href="'+t+'&show=csv">signals.csv</a></li><li><a style="color:#0000ff" href="'+t+'&show=kml">signals.kml</a></li><li><a style="color:#0000ff" href="'+t+'&show=txt">signals.txt</a></li></ul>').dialog({buttons:[{text:msg.close,click:function(){$(this).dialog("close")}}],open:function(){$(".ui-dialog-buttonpane button").focus()},modal:!0,title:msg.share.signals.title})}var SLMap={init:function(){var t,e,o="",n="";for(t in listeners)o+='<tr id="listener_'+(e=listeners[t]).id+'" data-map="'+e.x+"|"+e.y+"|"+e.id+'"'+(e.dt?' title="'+msg.daytime+'"':"")+'>\n<td>\n<img src="'+base_image+"/map_point"+(e.pri?1:2)+'.gif" alt="'+(e.pri?msg.qth_pri:msg.qth_sec)+'" />\n<a href="'+base_url+"listeners/"+e.id+'" class="'+(e.pri?"pri":"sec")+'">'+e.name+"</a>\n</td>\n<td>"+e.sp+"</td>\n<td>"+e.itu+"</td>\n<td>"+(e.dt?"<b>"+e.km+"</b>":e.km)+"</td>\n<td>"+(e.dt?"<b>"+e.mi+"</b>":e.mi)+"</td>\n</tr>\n",n+='<area alt="'+e.name+'" title="'+e.name+'" shape="circle" href="'+base_url+"listeners/"+e.id+'" coords="'+e.x+","+e.y+',4" data-map="'+e.id+'" />\n';$(".results tbody").html(o),$("#imgmap").html(n),SLMap.setActions()},setActions:function(){$("area[data-map]").mouseover(function(){$("#listener_"+$(this).data("map")).css({backgroundColor:"#ffff00"}).trigger("mouseenter")}).mouseout(function(){$("#listener_"+$(this).data("map")).css({backgroundColor:""}).trigger("mouseleave")}),$("tr[data-map]").mouseover(function(){var e=$(this).data("map").split("|"),t=$("#rx_map"),o=t.width()/t[0].naturalWidth;$("#point_here").show().css({left:e[0]*o-5+"px",top:e[1]*o-5+"px"}).unbind().click(function(t){return t.preventDefault(),$("#listener_"+e[2]+" a").trigger("click"),!1})}).mouseout(function(){$("#point_here").hide()}),$("tr[data-map] a").click(function(){var t="listeners_"+$(this).data("map");return window.open(this.href,t,popWinSpecs["listeners_[id]"]),!1})}},SMap={map:null,icons:{},infoWindow:null,markers:[],options:{},init:function(){var t=["dgps","dsc","hambcn","navtex","ndb","time","other"],e=[0,1];for(var o in t)for(var n in e){var i=base_image+"/pins/"+t[o]+"_"+e[n]+".png";SMap.icons[t[o]+"_"+e[n]]=new google.maps.MarkerImage(i,new google.maps.Size(12,20))}SMap.options={zoom:7,center:new google.maps.LatLng(center.lat,center.lon),mapTypeId:google.maps.MapTypeId.ROADMAP},SMap.map=new google.maps.Map($("#map").get(0),SMap.options),box[0].lat===box[1].lat&&box[0].lon===box[1].lon||SMap.map.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(box[0].lat,box[0].lon),new google.maps.LatLng(box[1].lat,box[1].lon))),SMap.infoWindow=new google.maps.InfoWindow,SMap.drawGrid(),SMap.drawMarkers(),SMap.drawQTH(),SMap.setActions(),setExternalLinks(),setClippedCellTitles()},drawGrid:function(){return drawGrid(SMap.map,layers)},drawMarkers:function(){var t,e,o,n,i;if(signals){for(e in i="undefined"==typeof listener?"S":"LS",SMap.markerGroups=new google.maps.MVCObject,types)SMap.markerGroups.set("type_"+types[e]+"_0",SMap.map),SMap.markerGroups.set("type_"+types[e]+"_1",SMap.map);for(e in SMap.markerGroups.set("highlight",SMap.map),o={url:base_image+"/map_point_here.gif",origin:new google.maps.Point(0,0),anchor:new google.maps.Point(6,7)},t="",signals)s=signals[e],t+='<tr class="type_'+s.typeId+" type_"+s.className+(void 0!==s.logged?s.logged?" logged":" unlogged":"")+'" id="signal_'+s.id+'" data-gmap="'+s.lat+"|"+s.lon+'">'+(void 0!==s.logged?"<th>"+(s.logged?"&#x2714;":"&nbsp;")+"</th>":"")+"<td>"+s.khz+'</td><td class="text-nowrap"><a href="'+base_url+"signals/"+s.id+'" class="'+(s.active?"":"inactive")+'" data-popup="1">'+s.call+'</a></td><td class="clipped">'+s.qth+"</td><td>"+s.sp+"</td><td>"+s.itu+"</td>"+("LS"==i?'<td class="num">'+s.km+"</td>":"")+("LS"==i?'<td class="num">'+s.mi+"</td>":"")+"</tr>",n=new google.maps.Marker({id:"point_"+s.id,icon:SMap.icons[s.icon+"_"+(s.active?1:0)],position:new google.maps.LatLng(s.lat,s.lon),title:strip_tags(s.khz+" "+s.call)}),google.maps.event.addListener(n,"click",SMap.markerClickFunction(s)),n.bindTo("map",SMap.markerGroups,"type_"+s.typeId+"_"+(s.active?"1":"0")),markers.push(n);$(".results tbody").append(t),$("tr[data-gmap]").mouseover(function(){var t=$(this).data("gmap").split("|");highlight=new google.maps.Marker({position:new google.maps.LatLng(t[0],t[1]),map:SMap.map,icon:o})}).mouseout(function(){highlight.setMap(null)}),$(".no-results").hide(),$(".results").show()}},drawQTH:function(){"undefined"!=typeof listener&&(layers.qth=new google.maps.Marker({position:{lat:listener.lat,lng:listener.lng},map:SMap.map,icon:{scaledSize:new google.maps.Size(30,30),url:"//maps.google.com/mapfiles/kml/pushpin/red-pushpin.png"},title:listener.name,zIndex:100}),qthInfo=new google.maps.InfoWindow({content:"<h2>"+listener.name+"</h2><p>"+listener.qth+"</p>"}),layers.qth.addListener("click",function(){qthInfo.open(SMap.map,layers.qth)}))},markerClickFunction:function(o){return function(t){t.cancelBubble=!0,t.returnValue=!1,t.stopPropagation&&(t.stopPropagation(),t.preventDefault());var e='<div class="map_info">  <h3><a href="'+base_url+"signals/"+o.id+'" onclick="return popup(this.href);">'+o.khz+" "+o.call+'</a></h3>  <table class="info-body">'+(void 0!==o.logged?"    <tr><th>"+msg.logged+"</th><td>"+(o.logged?msg.yes:msg.no)+"</td></tr>":"")+"    <tr><th>"+msg.id+"</th><td>"+o.call+"</td></tr>    <tr><th>"+msg.khz+"</th><td>"+o.khz+"</td></tr>    <tr><th>"+msg.type+"</th><td>"+o.type+"</td></tr>"+("0"!==o.pwr?"    <tr><th>"+msg.power+"</th><td>"+o.pwr+"W</td></tr>":"")+"    <tr><th>"+msg.name_qth+"</th><td>"+o.qth+(o.sp?", "+o.sp:"")+", "+o.itu+"</td></tr>"+(o.gsq?"    <tr><th>"+msg.gsq+'</th><td><a href="'+base_url+"signals/"+o.id+'/map" onclick="return popup(this.href);" title="Show map (accuracy limited to nearest Grid Square)">'+o.gsq+"</a></td></tr>":"")+"    <tr><th>"+msg.lat_lon+"</th><td>"+o.lat+", "+o.lon+"</td></tr>"+(o.usb||o.lsb?"    <tr><th>"+msg.sidebands+"</th><td>"+(o.lsb?"LSB: "+o.lsb:"")+(o.usb?(o.lsb?", ":"")+" USB: "+o.usb:"")+"</td></tr>":"")+(o.sec||o.fmt?"    <tr><th>"+msg.sec_format+"</th><td>"+(o.sec?o.sec+" sec":"")+(o.sec&&o.fmt?", ":"")+o.fmt+"</td></tr>":"")+"    <tr><th>"+msg.last_logged+"</th><td>"+o.heard+"</td></tr>    <tr><th>"+msg.heard_in+"</th><td>"+o.heard_in+"</td></tr>  </table></div>";SMap.infoWindow.setContent(e),SMap.infoWindow.setPosition(new google.maps.LatLng(o.lat,o.lon)),SMap.infoWindow.open(SMap.map)}},setActions:function(){$("#layer_grid").click(function(){var t,e;for(e in t=$("#layer_grid").prop("checked"),layers.grid)layers.grid[e].setMap(t?SMap.map:null)}),$("#layer_qth").click(function(){layers.qth.setMap($("#layer_qth").prop("checked")?SMap.map:null)}),$("#layer_active").click(function(){var t,e,o,n;for(t in types)n=types[t],e=$("#layer_active"),o=$("#layer_"+n),SMap.markerGroups.set("type_"+n+"_1",e.prop("checked")&&o.prop("checked")?SMap.map:null),o.prop("checked")&&e.prop("checked")?$(".results tbody .type_"+n+".active").show():$(".results tbody .type_"+n+".active").hide()}),$("#layer_inactive").click(function(){var t,e,o,n;for(t in types)n=types[t],e=$("#layer_inactive"),o=$("#layer_"+n),SMap.markerGroups.set("type_"+n+"_0",e.prop("checked")&&o.prop("checked")?SMap.map:null),o.prop("checked")&&e.prop("checked")?$(".results tbody .type_"+n+".inactive").show():$(".results tbody .type_"+n+".inactive").hide()}),types.forEach(function(e){$("#layer_"+e).click(function(){var t=$("#layer_"+e);SMap.markerGroups.set("type_"+e+"_0",$("#layer_inactive").prop("checked")&&t.prop("checked")?SMap.map:null),SMap.markerGroups.set("type_"+e+"_1",$("#layer_active").prop("checked")&&t.prop("checked")?SMap.map:null),t.prop("checked")?($("#layer_inactive").prop("checked")?$(".results tbody .type_"+e+".inactive").show():$(".results tbody .type_"+e+".inactive").hide(),$("#layer_active").prop("checked")?$(".results tbody .type_"+e+".active").show():$(".results tbody .type_"+e+".active").hide()):$(".results tbody .type_"+e).hide()})})}};function initSignalsForm(t,e,o){$(document).ready(function(){setFormPagingActions(),setFormPersonaliseAction(),setFormOffsetsAction(),setFormRangeAction(),setFormRangeUnitsDefault(),setFormSortbyAction(),setFormSortZaAction(),setFormShowModeAction(),setFormTypesStyles(),setFormTypesDefault(),setFormTypesAllAction(),setFormCountryAction(),setFormAdminAction(),setFormRegionAction(),setFormRwwFocusAction(),setFormStatesLabelLink(),setFormCountriesLabelLink(),setFormListenerInvertDefault(),setFormHeardInModDefault(),setFormListenerOptionsStyle(),setFormDatePickers(),setFormCollapseSections(),setFormResetAction("signals"),setColumnSortActions(),setColumnSortedClass(),setFormPagingStatus(t,e),setSignalActions(),setFocusOnCall(),o||(setExternalLinks(),scrollToResults(),RT.init($("#wide"),$("#narrow")))})}function setSignalActions(){$("#btn_csv_all").click(function(){confirm(msg.export.replace(":system",system.toUpperCase()).replace(":format",".csv")+"\n"+msg.export2)&&window.location.assign(window.location+"/export/csv"+shareableLink.getFromTypes())}),$("#btn_kml_all").click(function(){confirm(msg.export.replace(":system",system.toUpperCase()).replace(":format",".kml")+"\n"+msg.export2)&&window.location.assign(window.location+"/export/kml"+shareableLink.getFromTypes())}),$("#btn_txt_all").click(function(){shareableLink.getFromTypes(),confirm(msg.export.replace(":system",system.toUpperCase()).replace(":format",".txt")+"\n"+msg.export2)&&window.location.assign(window.location+"/export/txt"+shareableLink.getFromTypes())}),$("#btn_xls_all").click(function(){confirm(msg.export.replace(":system",system.toUpperCase()).replace(":format","PSKOV")+"\n"+msg.export2)&&window.location.assign(window.location+"/export/xls"+shareableLink.getFromTypes())}),$("#btn_csv_fil").click(function(){var t=$("#form_show"),e=t.val();t.val("csv"),$("#form_submit").click(),t.val(e)}),$("#btn_kml_fil").click(function(){var t=$("#form_show"),e=t.val();t.val("kml"),$("#form_submit").click(),t.val(e)}),$("#btn_txt_fil").click(function(){var t=$("#form_show"),e=t.val();t.val("txt"),$("#form_submit").click(),t.val(e)}),$("#btn_prt").click(function(){return window.print(),!1}),$("#btn_share").click(function(){return shareSignals(),!1}),$("#btn_new").click(function(){return window.open("./signals/new","signal_new",popWinSpecs["signals_[id]"]),!1})}var DGPS={init:function(){$("#frm_dgps").on("submit",function(){return $("#dgps_details").val(DGPS.lookup($("#dgps_ref").val())),!1}),$("a[data-dgps]").on("click",function(){return $("#dgps_ref").val($(this).data("dgps")),$("#dgps_go").trigger("click"),!1}),$("#dgps_ref").on("focus",function(){$(this).select()}),$("#close").on("click",function(){window.close()})},a:function(t,e,o,n,i,a,s,r,l){void 0===this.entries[t]&&(this.entries[t]=[]),this.entries[t].push([o,n,i,a,s,r,t,e,l]),void 0===this.entries[e]&&(this.entries[e]=[]),this.entries[e].push([o,n,i,a,s,r,t,e,l])},entries:[],lookup:function(t){var e=[];if(""===t)return"";if(void 0===this.entries[parseFloat(t)])return msg.tools.dgps.nomatch;t=parseFloat(t);for(var o=0;o<this.entries[t].length;o++){var n=this.entries[t][o];e.push("  Station "+n[0]+(0===n[8]?" "+msg.tools.dgps.inactive:"")+"\n  "+n[1]+"KHz "+n[2]+"bps\n  "+n[3]+" "+n[4]+" "+n[5]+"\n  Reference ID(s): "+n[6]+(n[6]!==n[7]?", "+n[7]:""))}return 1<o?msg.tools.dgps.multiple+" ("+o+"):\n"+e.join("\n\n"):e.join("")}},CONVERT={deg_dms:function(t,e){var o,n,i,a,s,r,l,c,d;return!(!VALIDATE.dec_lat(t)||!VALIDATE.dec_lon(e))&&(i=0<t?"N":"S",o=Math.abs(t),n=Math.floor(o),a=lead(Math.floor(o%1*60)),s=lead(Math.floor(3600*(o-n-a/60))),c=0<e?"E":"W",r=Math.abs(e),{lat_dd_mm_ss:n+"."+a+"."+s+"."+i,lon_dd_mm_ss:(l=Math.floor(r))+"."+(d=lead(Math.floor(r%1*60)))+"."+lead(Math.floor(3600*(r-l-d/60)))+"."+c})},deg_gsq:function(t,e){var o,n,i,a,s,r="abcdefghijklmnopqrstuvwxyz";return!(!VALIDATE.dec_lat(t)||!VALIDATE.dec_lon(e))&&(o=parseFloat(t)+90,n=r.charAt(Math.floor(o/10)).toUpperCase(),i=Math.floor(o%10),a=r.charAt(Math.floor(o%1*24)),s=(parseFloat(e)+180)/2,r.charAt(Math.floor(s/10)).toUpperCase()+n+Math.floor(s%10)+i+r.charAt(Math.floor(s%1*24))+a)},dms_deg:function(t,e){var o,n,i,a,s,r,l;return s=/([0-9]+)[^0-9]([0-9]+)[^0-9]([0-9]+)[^0-9]([NS])/i,r=/([0-9]+)[^0-9]([0-9]+)[^0-9]([0-9]+)[^0-9]([EW])/i,o=t.match(s),i=parseFloat(o[1]),a=parseFloat(o[2]),l=""!==o[3]?parseFloat(o[3]):0,n=(void 0===o[4]||"N"===o[4]||"n"===o[4]?1:-1)*(i+Math.round(1e4*(l/3600+a/60))/1e4),o=e.match(r),i=parseFloat(o[1]),a=parseFloat(o[2]),l=""!==o[3]?parseFloat(o[3]):0,{lat:n,lon:(void 0===o[4]||"E"===o[4]||"e"===o[4]?1:-1)*(i+Math.round(1e4*(l/3600+a/60))/1e4)}},gsq_deg:function(t){var e,o,n,i,a,s,r,l;return!!VALIDATE.gsq(t)&&(l=6===(t=t.toUpperCase()).length?1/48:0,a=(t+=4===t.length?"MM":"").charCodeAt(0)-65,s=parseFloat(t.substr(2,1)),r=t.charCodeAt(4)-65,e=t.charCodeAt(1)-65,o=parseFloat(t.substr(3,1)),n=t.charCodeAt(5)-65,i=Math.round(1e4*(2*(10*a+s+r/24+l)-180))/1e4,{lat:Math.round(1e4*(10*e+o+n/24+l-90))/1e4,lon:i})},gsq_gsq_dx:function(t,e){var o,n,i,a,s;if(t=CONVERT.gsq_deg(t),e=CONVERT.gsq_deg(e),!t||!e)return!1;n=parseFloat(t.lat),a=parseFloat(t.lon),i=parseFloat(e.lat),s=parseFloat(e.lon);var r=(i*=o=Math.PI/180)-(n*=o),l=(s*=o)-(a*=o),c=(1-Math.cos(r)+(1-Math.cos(l))*Math.cos(n)*Math.cos(i))/2;return{dx_km:Math.round(12742*Math.asin(Math.sqrt(c))),dx_miles:Math.round(7917.5*Math.asin(Math.sqrt(c)))}}},VALIDATE={gsq:function(t){return t.match(/^([a-rA-R]{2})([0-9]{2})([a-xA-X]{2})?$/i)},dec_lat:function(t){return!(isNaN(t)||90<=t||t<=-90)},dec_lon:function(t){return!(isNaN(t)||180<=t||t<=-180)},dms_lat:function(t){return t.match(/^([0-9]{1,2})[^0-9]([0-5][0-9])[^0-9]([0-5][0-9])[^0-9]?([NS])?$/i)},dms_lon:function(t){return t.match(/^([0-9]{1,3})[^0-9]([0-5][0-9])[^0-9]([0-5][0-9])[^0-9]?([EW])?$/i)},float:function(t,e,o,n){var i="Please enter a number",a=parseFloat(t);return isNaN(a)?(alert(n+":\n"+i),!1):a<e?(alert(n+":\n"+i+" >= "+e),!1):!(o<a)||(alert(n+":\n"+i+" <= "+o),!1)},int:function(t,e,o,n){var i=parseInt(t),a="Please enter a number";return isNaN(i)?(alert(n+":\n"+a),!1):i<e?(alert(n+":\n"+a+" >= "+e),!1):!(o<i)||(alert(n+":\n"+a+" <= "+o),!1)}},COORDS={init:function(){var cmd_1,cmd_2,idx,modes;for(modes=[["dms_deg","deg_gsq"],["deg_dms","deg_gsq"],["gsq_deg","deg_dms"]],idx=0;idx<modes.length;idx++)cmd_1="COORDS."+modes[idx][0]+"();",cmd_2="COORDS."+modes[idx][1]+"();",function(i,c1,c2){$("#go_"+i).on("click",function(){return eval(c1)&&eval(c2),!1}),$("#map_"+i).on("click",function(){return eval(c1)&&(eval(c2),COORDS.map("map")),!1}),$("#photo_"+i).on("click",function(){return eval(c1)&&(eval(c2),COORDS.map("photo")),!1})}(idx+1,cmd_1,cmd_2);$("#close").on("click",function(){window.close()})},map:function(t){var e,o,n,i;o=$("#lat_dddd").val(),n=$("#lon_dddd").val(),""!==o&&""!==n&&(i=base_url+"maps/coords/"+o+"/"+n+"/"+t,e="_"+o+"_"+n,window.open(i,e,"scrollbars=1,resizable=1,location=1,width=860,height=630"))},deg_gsq:function(){var t,e;return t=$("#lat_dddd").val(),e=$("#lon_dddd").val(),VALIDATE.dec_lat(t)?VALIDATE.dec_lon(e)?void $("#gsq").val(CONVERT.deg_gsq(t,e)):(alert(msg.tools.coords.lon_dec),!1):(alert(msg.tools.coords.lat_dec),!1)},gsq_deg:function(){var t,e;return t=$("#gsq").val(),VALIDATE.gsq(t)?(e=CONVERT.gsq_deg(t),$("#lat_dddd").val(e.lat),$("#lon_dddd").val(e.lon),!0):(alert(msg.tools.coords.gsq_format),!1)},deg_dms:function(){var t,e,o;return t=parseFloat($("#lat_dddd").val()),e=parseFloat($("#lon_dddd").val()),VALIDATE.dec_lat(t)?VALIDATE.dec_lon(e)?(o=CONVERT.deg_dms(t,e),$("#lat_dd_mm_ss").val(o.lat_dd_mm_ss),$("#lon_dd_mm_ss").val(o.lon_dd_mm_ss),!0):(alert(msg.tools.coords.lon_dec),!1):(alert(msg.tools.coords.lat_dec),!1)},dms_deg:function(){var t,e,o;return e=$("#lat_dd_mm_ss").val(),o=$("#lon_dd_mm_ss").val(),VALIDATE.dms_lat(e)?VALIDATE.dms_lon(o)?(t=CONVERT.dms_deg(e,o),$("#lat_dddd").val(t.lat),$("#lon_dddd").val(t.lon),!0):(alert(msg.tools.coords.lon_dms_1+"\n  DDDÂ°MM'SS\"H\n  DDD.MM.SS.H\n  DDD MM SS H\n  DDD.MM.H\n  DDDÂ°MM.H\n  DDD MM H\n\n"+msg.tools.coords.lon_dms_2),!1):(alert(msg.tools.coords.lat_dms_1+"\n  DDÂ°MM'SS\"H\n  DD.MM.SS.H\n  DD MM SS H\n  DDÂ°MM.H\n  DD.MM.H\n  DD MM H\n\n"+msg.tools.coords.lat_dms_2),!1)}},NAVTEX={init:function(){$("#frm_navtex").on("submit",function(){return!1}),$("#translateMumbo").on("click",function(){$("#navtex2").val(NAVTEX.mumboToText($("#navtex1").val()))}),$("#clearoutMumbo").on("click",function(){$("#navtex1").val("")}),$("#clearoutText").on("click",function(){$("#navtex2").val("")}),$("#clearoutAll").on("click",function(){$("#navtex1").val(""),$("#navtex2").val("")}),$("#translateText").on("click",function(){$("#navtex1").val(NAVTEX.textToMumbo($("#navtex2").val()))}),$("#close").on("click",function(){window.close()})},mumboChars:"-?:$3!&#8*().,9014'57=2/6+",textChars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",mumboChar:function(t){var e=NAVTEX.textChars.indexOf(t);return-1<e?NAVTEX.mumboChars.charAt(e):t},textChar:function(t){var e=NAVTEX.mumboChars.indexOf(t);return-1<e?NAVTEX.textChars.charAt(e):t},textToMumbo:function(t){var e,o="";for(e=0;e<t.length;e++)o+=NAVTEX.mumboChar(t.charAt(e).toUpperCase());return o},mumboToText:function(t){var e,o="";for(e=0;e<t.length;e++)o+=NAVTEX.textChar(t.charAt(e));return o}},COOKIE={clear:function(t,e){document.cookie=t+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path="+("string"==typeof e?e:"/")},get:function(t){var e=document.cookie,o=e.indexOf(t+"=");if(-1===o)return!1;var n=o+t.length+1,i=e.indexOf(";",n);return-1===i&&(i=e.length),unescape(e.substring(n,i))},set:function(t,e,o){var n=new Date;n.setFullYear(n.getFullYear()+1),document.cookie=t+"="+e+";expires="+n.toGMTString()+"; path="+("string"==typeof o?o:"/")}},SUNRISE={init:function(){var t=new Date,e=$("#sunrise_clear"),o=$("#sunrise_go"),n=$("#sunrise_gsq"),i=$("#sunrise_lat"),a=$("#sunrise_lon"),s=$("#sunrise_DD"),r=$("#sunrise_MM"),l=$("#sunrise_YYYY");if($("#close").on("click",function(){window.close()}),l.on("change",function(){VALIDATE.int(this,1901,2099,"Year")}).val(t.getUTCFullYear()),r.on("change",function(){VALIDATE.int(this,1,12,"Month")}).val(t.getUTCMonth()+1),s.on("change",function(){VALIDATE.int(this,1,31,"Date")}).val(t.getUTCDate()),n.on("change",function(){VALIDATE.gsq($(this).val())?SUNRISE.gsq_deg($(this).val()):alert(msg.tools.coords.gsq_format)}),i.on("change",function(){VALIDATE.float($(this).val(),-90,90,"Latitude")}),a.on("change",function(){VALIDATE.float($(this).val(),-180,180,"Longitude")}),o.on("click",function(){return $("#sunrise_result").val(SUNRISE.formValues()),SUNRISE.cookie_set(),!1}),e.on("click",function(){SUNRISE.cookie_clear()}),SUNRISE.cookie_get()){var c=SUNRISE.cookie_get("sunrise").split("|");n.val(c[0]),i.val(c[1]),a.val(c[2])}},cookie_clear:function(){COOKIE.clear("sunrise")},cookie_get:function(){return COOKIE.get("sunrise")},cookie_set:function(){var t=$("#sunrise_gsq").val()+"|"+$("#sunrise_lat").val()+"|"+$("#sunrise_lon").val();COOKIE.set("sunrise",t)},formValues:function(){var t=parseFloat($("#sunrise_lat").val()),e=parseFloat($("#sunrise_lon").val()),o=parseInt($("#sunrise_YYYY").val()),n=parseInt($("#sunrise_MM").val()),i=parseInt($("#sunrise_DD").val());if(VALIDATE.float(t,-90,90,"Latitude")&&VALIDATE.float(e,-180,180,"Longitude")&&VALIDATE.int(o,1901,2099,"Year")&&VALIDATE.int(n,1,12,"Month")){var a,s=Math.abs(t),r=Math.abs(e);if(a=2===n&&o%4==0?29:2===n?28:4===n||6===n||9===n||11===n?30:31,VALIDATE.int(i,1,a,"Date")){sunRiseSet(o,n,i,t,e),civTwilight(o,n,i,t,e);var l="On "+o+"-"+(n<10?"0":"")+n+"-"+(i<10?"0":"")+i+"\nAt "+s+(t<0?"S":"N")+"  / "+r+(e<0?"W":"E")+"\n-----------------------\nSunrise / Sunset UTC\n-----------------------\n",c=Math.floor(twStartT),d=Math.floor(60*(twStartT-c)),p=Math.floor(sRiseT),m=Math.floor(60*(sRiseT-p)),g=Math.floor(sSetT),h=Math.floor(60*(sSetT-g)),u=Math.floor(twEndT),f=Math.floor(60*(twEndT-u));return 0==twStatus?(l+="Twilight starts: ",c<10&&(l+="0"),l+=c+".",d<10&&(l+="0"),l+=d+"\n"):l+=0<twStatus&&srStatus<=0?"Twilight all night\n":"No twilight this day\n",0==srStatus?(l+="Sunrise:         ",p<10&&(l+="0"),l+=p+".",m<10&&(l+="0"),l+=m+"\n",l+="Sunset:          ",g<10&&(l+="0"),l+=g+".",h<10&&(l+="0"),l+=h+"\n"):l+=0<srStatus?"Sun is up 24 hrs\n":"Sun is down 24 hrs\n",0==twStatus&&(l+="Twilight ends:   ",u<10&&(l+="0"),l+=u+".",f<10&&(l+="0"),l+=f),l+="\n-----------------------",l+="\n(From "+document.title.substr(0,3)+")"}}},gsq_deg:function(){var t,e;return t=$("#sunrise_gsq").val(),VALIDATE.gsq(t)?(e=CONVERT.gsq_deg(t),$("#sunrise_lat").val(e.lat),$("#sunrise_lon").val(e.lon),!0):(alert(msg.tools.coords.gsq_format),!1)}},twAngle=-6,srAngle=-35/60,sRiseT,sSetT,srStatus,twStartT,twEndT,twStatus,sDIST,sRA,sDEC,sLON;function dayDiff2000(t,e,o){return 367*t-7*(t+(e+9)/12)/4+275*e/9+o-730530}var RADEG=180/Math.PI,DEGRAD=Math.PI/180;function sind(t){return Math.sin(t*DEGRAD)}function cosd(t){return Math.cos(t*DEGRAD)}function acosd(t){return RADEG*Math.acos(t)}function atan2d(t,e){var o=RADEG*Math.atan(t/e);return e<0&&t<0?o-=180:(e<0&&0<t&&(o+=180),o)}function sunRiseSet(t,e,o,n,i){return sunTimes(t,e,o,n,i,srAngle,1)}function civTwilight(t,e,o,n,i){return sunTimes(t,e,o,n,i,twAngle,0)}function sunTimes(t,e,o,n,i,a,s){var r,l,c,d,p,m=0;d=revolution(GMST0(r=dayDiff2000(t,e,o)+.5-i/360)+180+i),sunRaDec(r),c=12-rev180(d-sRA)/15,0!=s&&(a-=.2666/sDIST),l=1<=(p=(sind(a)-sind(n)*sind(sDEC))/(cosd(n)*cosd(sDEC)))?(m=-1,0):p<=-1?(m=1,12):acosd(p)/15,0!=s?((sRiseT=c-l)<0&&(sRiseT+=24),24<(sSetT=c+l)&&(sSetT-=24),srStatus=m):((twStartT=c-l)<0&&(twStartT+=24),24<(twEndT=c+l)&&(twEndT-=24),twStatus=m)}function sunRaDec(t){var e,o,n,i;sunPos(t),o=sDIST*cosd(sLON),i=(n=sDIST*sind(sLON))*sind(e=23.4393-3.563/1e7*t),n*=cosd(e),sRA=atan2d(n,o),sDEC=atan2d(i,Math.sqrt(o*o+n*n))}function sunPos(t){var e,o,n,i,a,s,r;o=282.9404+470935e-10*t,i=(e=revolution(356.047+.9856002585*t))+(n=.016709-1.151e-9*t)*RADEG*sind(e)*(1+n*cosd(e)),a=cosd(i)-n,s=Math.sqrt(1-n*n)*sind(i),sDIST=Math.sqrt(a*a+s*s),r=atan2d(s,a),360<=(sLON=r+o)&&(sLON-=360)}function revolution(t){return t-360*Math.floor(t*(1/360))}function rev180(t){return t-360*Math.floor(t*(1/360)+.5)}function GMST0(t){return revolution(818.9874+.985647352*t)}function initUsersForm(t,e){$(document).ready(function(){setFormPagingActions(),setColumnSortActions(),setColumnSortedClass(),setExternalLinks(),setFormPagingStatus(t,e),setUserActions()})}function setUserActions(){$("#btn_new").click(function(){return window.open("./users/new","user_new",popWinSpecs["users_[id]"]),!1})}var LIGHTNING={init:function(){var t=$("#lightning_clear"),o=$("#lightning_go"),e=$("#lightning_gsq"),n=$("#lightning_lat"),i=$("#lightning_lon"),a=$("#lightning_zoom"),s=$("#lightning_map"),r=$("#slider-range-max"),l=$("#lightning_zoom");if(r.slider({range:"max",min:1,max:10,value:l.val(),slide:function(t,e){a.val(e.value),n.val()&&i.val()&&o.trigger("click")}}),$("#close").on("click",function(){window.close()}),e.on("change, blur",function(){$(this).val()&&(VALIDATE.gsq($(this).val())?(LIGHTNING.gsq_deg($(this).val()),o.trigger("click"),LIGHTNING.cookie_set()):alert(msg.tools.coords.gsq_format))}),n.on("change",function(){VALIDATE.float($(this).val(),-90,90,"Latitude")}),i.on("change",function(){VALIDATE.float($(this).val(),-180,180,"Longitude")}),o.on("click",function(){var t=$("#lightning_lat").val(),e=$("#lightning_lon").val(),o=$("#lightning_zoom").val();return!!VALIDATE.float(t,-90,90,"Latitude")&&(!!VALIDATE.float(e,-180,180,"Longitude")&&void LIGHTNING.map_show(t,e,o))}),t.on("click",function(){LIGHTNING.cookie_clear(),e.val(""),n.val(""),i.val(""),s.prop("src",""),a.val(5),r.slider("option","value",5)}),LIGHTNING.cookie_get("lightning")){var c=LIGHTNING.cookie_get("lightning").split("|");e.val(c[0]),n.val(c[1]),i.val(c[2]),a.val(c[3]),r.slider("option","value",c[3])}$("a[data-coords]").click(function(){return c=$(this).data("coords").split("|"),e.val(""),n.val(c[0]),i.val(c[1]),a.val(c[2]),r.slider("option","value",c[2]),LIGHTNING.map_show(c[0],c[1],c[2]),LIGHTNING.cookie_clear(),!1})},cookie_clear:function(){COOKIE.clear("lightning")},cookie_get:function(){return COOKIE.get("lightning")},cookie_set:function(){var t=$("#lightning_gsq").val()+"|"+$("#lightning_lat").val()+"|"+$("#lightning_lon").val()+"|"+$("#lightning_zoom").val();COOKIE.set("lightning",t)},gsq_deg:function(t){var e=CONVERT.gsq_deg(t);return $("#lightning_lat").val(e.lat),$("#lightning_lon").val(e.lon),!0},map_show:function(t,e,o){var n="https://map.blitzortung.org?interactive=1&NavigationControl=0&FullScreenControl=1&Cookies=0&InfoDiv=0&MenuButtonDiv=1&ScaleControl=1&CountingRangeValue=3&CountingCheckboxChecked=1&DetectorsCheckboxChecked=0&DetectorsRange=0&AudioCheckboxChecked=0&LinksCheckboxChecked=0&LinksRangeValue=0&MapStyle=0&MapStyleRangeValue=0&Advertisment=0#"+o+"/"+t+"/"+e;$("#lightning_map").prop("src",n)}};