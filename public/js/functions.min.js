/*!
* Project:   RXX - NDB Logging Database
* Homepage:  https://rxx.classaxe.com
* Date:      2019-08-24
* Licence:   LGPL
* Copyright: 2019 Martin Francis
*/
function getlimitOptions(e,t,r){var o=[10,20,50,100,200,500,1e3,2e3,5e3,1e5,2e4,5e4,1e5],a="";for(var i in o)e<o[i]||(a+='<option value="'+o[i]+'"'+(parseInt(t)===o[i]?' selected="selected"':"")+">"+o[i]+" results</option>");return a+='<option value="'+(o[0]<e?-1:r)+'"'+(-1===parseInt(t)?' selected="selected"':"")+">All results</option>"}function getMetar(e){window.open("https://www.aviationweather.gov/metar/data?ids="+$("#form_icao").val()+"&format="+(e?"decoded":"raw")+"&taf=on&layout=off&hours="+$("#form_hours").val(),"popMETAR"+e,"scrollbars=1,resizable=1,location=1")}function getPagingOptions(e,t,r){var o="";pages=e/t;for(var a=0;a<pages;a++)o+='<option value="'+a+'"'+(parseInt(r)===a?' selected="selected"':"")+">"+(1+a*t)+"-"+(e<(a+1)*t?e:(a+1)*t)+"</option>";return o}function initListenerSignalsMap(){var e,t,r;for(r in TxtOverlay=initMapsTxtOverlay(),ShowGrid=initMapsShowGrid(),map=new google.maps.Map(document.getElementById("map"),{center:{lat:listener.lat,lng:listener.lng},scaleControl:!0,zoomControl:!0,zoom:2}),layers.qth=new google.maps.Marker({position:{lat:listener.lat,lng:listener.lng},map:map,icon:{scaledSize:new google.maps.Size(30,30),url:"//maps.google.com/mapfiles/kml/pushpin/red-pushpin.png"},title:listener.name}),e=new google.maps.InfoWindow({content:"<h2>"+listener.name+"</h2><p>"+listener.qth+"</p>"}),layers.qth.addListener("click",function(){e.open(map,layers.qth)}),ShowGrid(map,"gridLabel"),listener.types)t=listener.types[r],layers[t+"_0"]=new google.maps.KmlLayer({url:listener.source+"/"+t+"/0?v=a"+listener.logLatest,preserveViewport:!0,map:map}),layers[t+"_1"]=new google.maps.KmlLayer({url:listener.source+"/"+t+"/1?v=a"+listener.logLatest,preserveViewport:!0,map:map});google.maps.event.addDomListener(document.getElementById("layer_grid"),"click",function(e){!function(){var e;if(null==layers.grid[0].getMap())for(e in layers.grid)layers.grid[e].setMap(map);else for(e in layers.grid)layers.grid[e].setMap(null)}()}),google.maps.event.addDomListener(document.getElementById("layer_inactive"),"click",function(e){!function(){for(r in listener.types)t=listener.types[r],document.getElementById("layer_"+t).checked&&(document.getElementById("layer_inactive").checked?layers[t+"_0"].setMap(map):layers[t+"_0"].setMap(null))}()}),google.maps.event.addDomListener(document.getElementById("layer_qth"),"click",function(e){null==layers.qth.getMap()?layers.qth.setMap(map):layers.qth.setMap(null)}),listener.types.forEach(function(r){google.maps.event.addDomListener(document.getElementById("layer_"+r),"click",function(e){var t;null==layers[(t=r)+"_1"].getMap()?(layers[t+"_1"].setMap(map),document.getElementById("layer_inactive").checked?layers[t+"_0"].setMap(map):layers[t+"_0"].setMap(null)):(layers[t+"_0"].setMap(null),layers[t+"_1"].setMap(null))})})}function initMapsShowGrid(){return function(e,t){var r,o,a;for(o=0;o<180;o+=10)layers.grid.push(new google.maps.Polyline({path:[{lat:o-90,lng:-180},{lat:o-90,lng:0},{lat:o-90,lng:180}],geodesic:!1,strokeColor:gridColor,strokeOpacity:gridOpacity,strokeWeight:.5}));for(a=0;a<360;a+=20)layers.grid.push(new google.maps.Polyline({path:[{lat:85.05,lng:a},{lat:-85.05,lng:a}],geodesic:!1,strokeColor:gridColor,strokeOpacity:gridOpacity,strokeWeight:.5}));for(o=10;o<170;o+=10)for(a=0;a<360;a+=20)layers.grid.push(new TxtOverlay(new google.maps.LatLng(o-90+5,a-180+10),String.fromCharCode(a/20+65)+String.fromCharCode(o/10+65),t,e));for(r in layers.grid)layers.grid[r].setMap(e)}}function initMapsTxtOverlay(){function e(e,t,r,o){this.pos=e,this.txt_=t,this.cls_=r,this.map_=o,this.div_=null,this.setMap(o)}return(e.prototype=new google.maps.OverlayView).onAdd=function(){var e,t;(e=document.createElement("DIV")).className=this.cls_,e.innerHTML=this.txt_,this.div_=e,t=this.getProjection().fromLatLngToDivPixel(this.pos),e.style.left=t.x+"px",e.style.top=t.y+"px",this.getPanes().floatPane.appendChild(e)},e.prototype.draw=function(){var e,t;t=this.getProjection().fromLatLngToDivPixel(this.pos),(e=this.div_).style.left=t.x+"px",e.style.top=t.y+"px"},e.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},e}function setClippedCellTitles(){$("td.clipped").each(function(){$(this).attr("title",$(this).text().trim())})}function setColumnSortActions(){$("table.results thead tr th[id]").each(function(){$(this).click(function(){var e=this.id.split("|")[0],t=this.id.split("|")[1];$(this).hasClass("sorted")&&(t="a"==$("#form_order").val()?"d":"a"),$("#form_sort").val(e),$("#form_order").val(t),$('form[name="form"]').submit()})})}function setColumnSortedClass(){$("table.results thead tr th").each(function(){this.id.split("|")[0]==$("#form_sort").val()&&($(this).append("d"==$("#form_order").val()?" &#9662;":" &#9652;"),$(this).addClass("sorted"))})}function setEmailLinks(){$("a[data-contact]").each(function(){var e=$(this).attr("data-contact").split("").reverse().join("").trim().replace("#","@");$(this).attr("href",e),$(this).removeAttr("data-contact")})}function setExternalLinks(){$('a[rel="external"]').attr("target","_blank"),$("a[data-popup]").click(function(){var e=$(this).data("popup").split("|");return window.open(this.href,e[0],e[1]),!1})}function setFormCountryAction(e){(e=void 0===e||e)?$("select#form_country").change(function(){$("#form_submit").click()}):$("select#form_country").off("change")}function setFormListenerOptionsStyle(){$("#form_listener").children().each(function(){""===$(this).val()?$(this).addClass("all"):". "===$(this).text().substr(0,2)?($(this).text("Â "+$(this).text().substr(1)),$(this).addClass("secondaryQth")):$(this).addClass("primaryQth")})}function setFormRangeAction(){$("#form_range_gsq").on("keyup",function(e){var t=$("#form_range_gsq").val().length<6;$("#form_range_min").attr("disabled",t),$("#form_range_max").attr("disabled",t)}),$("#form_range_min").on("keyup",function(e){var t=0===$("#form_range_min").val().length&&0===$("#form_range_max").val().length;$("#form_range_units").attr("disabled",t)}),$("#form_dx_max").on("keyup",function(e){var t=0===$("#form_range_min").val().length&&0===$("#form_range_max").val().length;$("#form_range_units").attr("disabled",t)}),$("#form_range_gsq").trigger("keyup"),$("#form_range_min").trigger("keyup")}function setFormRangeUnitsDefault(){0==$("fieldset#form_range_units div :radio:checked").length&&$("fieldset#form_range_units div :radio[value=km]").prop("checked",!0)}function setFormListenerInvertDefault(){0==$("fieldset#form_listener_invert div :radio:checked").length&&$("fieldset#form_listener_invert div :radio[value=0]").prop("checked",!0)}function setFormHeardInModDefault(){0==$("fieldset#form_heard_in_mod div :radio:checked").length&&$('fieldset#form_heard_in_mod div :radio[value="any"]').prop("checked",!0)}function setDatePickers(){$.datepicker.setDefaults({changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",yearRange:"1980:+0"}),$(".js-datepicker").datepicker({})}function setFormRegionAction(e){(e=void 0===e||e)?$("select#form_region").change(function(){$("#form_submit").click()}):$("select#form_region").off("change")}function setFormResetAction(e){switch(e){case"signals":$('button[type="reset"]').click(function(){return setFormRegionAction(!1),$("#form_types div :checkbox").prop("checked",!1),$("#form_types div :checkbox[value=type_NDB]").prop("checked",!0),$("#form_call").val(""),$("#form_khz_1").val(""),$("#form_khz_2").val(""),$("#form_channels").prop("selectedIndex",0),$("#form_active").prop("selectedIndex",0),$("#form_show").prop("selectedIndex",0),$("#form_offsets").prop("selectedIndex",0),$("#form_states").val(""),$("#form_sp_itu_clause").prop("selectedIndex",0),$("#form_countries").val(""),$("#form_region").prop("selectedIndex",0),$("#form_gsq").val(""),$("#form_range_gsq").val(""),$("#form_range_min").val(""),$("#form_range_max").val(""),$("#form_range_units_0").prop("checked",1),$("#form_range_gsq").trigger("keyup"),$("#form_range_min").trigger("keyup"),$("#form_listener").prop("selectedIndex",0),$("#form_listener_invert_0").prop("checked",1),$("#form_heard_in").val(""),$("#form_heard_in_mod_0").prop("checked",1),$("#form_logged_date_1").val(""),$("#form_logged_date_2").val(""),$("#form_logged_first_1").val(""),$("#form_logged_first_2").val(""),$("#form_logged_last_1").val(""),$("#form_logged_last_2").val(""),setFormRegionAction(!0),!1});break;case"listeners":$('button[type="reset"]').click(function(){return $("fieldset#form_types div :checkbox").prop("checked",!1),$("fieldset#form_types div :checkbox[value=type_NDB]").prop("checked",!0),$("#form_filter").val(""),setFormRegionAction(!1),setFormCountryAction(!1),$("select#form_region").prop("selectedIndex",0),$("select#form_country").prop("selectedIndex",0),setFormCountryAction(!0),setFormRegionAction(!0),!1})}}function setFormTypesStyles(){$("fieldset#form_types div input").each(function(){$(this).parent().attr("class",$(this).attr("class"))})}function setFormTypesDefault(){0==$("fieldset#form_types div :checkbox:checked").length&&$("fieldset#form_types div :checkbox[value=type_NDB]").prop("checked",!0)}function setFormTypesAllAction(){$("fieldset#form_types div :checkbox[value=type_ALL]").click(function(){$("fieldset#form_types div :checkbox").prop("checked",$(this).prop("checked"))})}function setPagingActions(){var e=$("#form_filter"),t=$("#form_prev"),r=$("#form_next"),o=$("#form_limit");o.length&&(o[0].outerHTML='<select id="form_limit" name="form[limit]" required="required">'+getlimitOptions(paging.total,o.val(),paging.limit)+"</select>",o=$("#form_limit"));var i=$("#form_page");i.length&&(i[0].outerHTML='<label class="sr-only" for="form_page">Page Control</label>\n<select id="form_page" name="form[page]" style="display:none">'+getPagingOptions(paging.total,o.val(),paging.page)+"</select>",i=$("#form_page"));var a=$("#form_page option");"-1"!==o.val()&&(t.show(),r.show(),i.show()),o.change(function(){var e=$('form[name="form"]'),t=$("#form_limit"),r=$("#form_page option"),o=$("#form_prev"),a=$("#form_next");r.eq(0).prop("selected",!0),i.prop("selectedIndex",0),"-1"!==t.val()?(o.show(),a.show(),i.show(),r.eq(0).prop("text","1-"+t.val()),o.prop("disabled","disabled"),a.prop("disabled","disabled")):(i.hide(),o.hide(),a.hide()),i.prop("selectedIndex",0),e.submit()}),0<paging.page?t.click(function(){var e=$('form[name="form"]'),t=$("#form_page"),r=$("#form_page option"),o=$("#form_prev"),a=$("#form_next");return o.prop("disabled","disabled"),a.prop("disabled","disabled"),r.eq(paging.page-1).prop("selected",!0),t.prop("selectedIndex",paging.page-1),e.submit(),!1}):t.prop("disabled","disabled"),paging.page+1<a.length?r.click(function(){var e=$('form[name="form"]'),t=$("#form_page"),r=$("#form_page option"),o=$("#form_prev"),a=$("#form_next");return o.prop("disabled","disabled"),a.prop("disabled","disabled"),r.eq(paging.page+1).prop("selected",!0),t.prop("selectedIndex",paging.page+1),e.submit(),!1}):r.prop("disabled","disabled"),i.change(function(){var e=$('form[name="form"]'),t=($("#form_page"),$("#form_prev")),r=$("#form_next");t.prop("disabled","disabled"),r.prop("disabled","disabled"),e.submit()}),e.change(function(){var e=$('form[name="form"]'),t=$("#form_page"),r=$("#form_page option"),o=$("#form_prev"),a=$("#form_next");r.eq(0).prop("selected",!0),t.prop("selectedIndex",0),o.prop("disabled","disabled"),a.prop("disabled","disabled"),e.submit()})}var gridColor,gridOpacity,map,layers=[];layers.grid=[],gridColor="#808080",gridOpacity=.5;