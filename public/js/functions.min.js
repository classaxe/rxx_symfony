/*
 * Project:    RXX - NDB Logging Database
 * Homepage:   https://rxx.classaxe.com
 * Version:    0.43.2
 * Date:       2020-03-12
 * Licence:    LGPL
 * Copyright:  2020 Martin Francis
 */
var highlight,map,gridColor="#808080",gridOpacity=.5,layers={grid:[]},markers=[],all_sections=[],award={},cart=[],popWinSpecs={"countries_*":"width=860,height=630,resizable=1",countries_af:"width=640,height=630,resizable=1",countries_as:"width=780,height=590,resizable=1",countries_eu:"width=680,height=590,resizable=1",countries_na:"width=640,height=220,resizable=1",countries_oc:"width=680,height=500,resizable=1",countries_sa:"width=320,height=600,resizable=1","listeners_[id]":"width=880,height=760,status=1,scrollbars=1,resizable=1","listeners_[id]_logs":"width=880,height=760,status=1,scrollbars=1,resizable=1","listeners_[id]_signals":"width=880,height=760,status=1,scrollbars=1,resizable=1","listeners_[id]_map":"width=880,height=760,status=1,scrollbars=1,resizable=1","listeners_[id]_locatormap":"width=880,height=760,status=1,scrollbars=1,resizable=1","listeners_[id]_signalsmap":"width=880,height=760,status=1,scrollbars=1,resizable=1","listeners_[id]_ndbweblog":"status=1,scrollbars=1,resizable=1",maps_af:"width=646,height=652,resizable=1",maps_alaska:"width=600,height=620,resizable=1",maps_as:"width=856,height=645,resizable=1",maps_au:"width=511,height=545,resizable=1",maps_eu:"width=704,height=760,resizable=1",maps_japan:"width=517,height=740,resizable=1",maps_na:"width=669,height=720,resizable=1",maps_pacific:"width=600,height=750,resizable=1",maps_polynesia:"width=500,height=525,resizable=1",maps_sa:"width=490,height=745,resizable=1","signals_[id]":"width=1040,height=800,status=1,scrollbars=1,resizable=1","signals_[id]_logs":"width=1040,height=800,status=1,scrollbars=1,resizable=1","signals_[id]_listeners":"width=1040,height=800,status=1,scrollbars=1,resizable=1","signals_[id]_map":"width=1040,height=800,status=1,scrollbars=1,resizable=1","signals_[id]_weather":"width=1040,height=800,status=1,scrollbars=1,resizable=1","states_*":"width=720,height=760,resizable=1",states_aus:"width=720,height=240,resizable=1",states_can_usa:"width=680,height=690,resizable=1"};function changeShowMode(e){$("#form_show").val(e),formSubmit()}function decodeHtmlEntities(e){return $("<div/>").html(e).text()}function exportSignallistExcel(){confirm((msg.export+"\n\n"+msg.time+"\n\n"+msg.options+"\n\n"+msg.continue).replace(":system",system.toUpperCase()).replace(":format",msg.excel))&&alert("OK")}function exportSignallistILG(){confirm((msg.export+"\n\n"+msg.nooptions+"\n\n"+msg.continue).replace(":system",system.toUpperCase()).replace(":format",msg.ilg))&&alert("OK")}function exportSignallistPDF(){confirm((msg.export+"\n\n"+msg.time+"\n\n"+msg.options+"\n\n"+msg.continue).replace(":system",system.toUpperCase()).replace(":format",msg.pdf))&&alert("OK")}function getLimitOptions(e,t,a){var o=[10,20,50,100,200,500,1e3,2e3,5e3,1e5,2e4,5e4,1e5],r="";for(var s in o)e<o[s]&&a<o[s]||(r+='<option value="'+o[s]+'"'+(parseInt(t)===o[s]?' selected="selected"':"")+">"+o[s]+" results</option>");return r+='<option value="'+(o[0]<e?-1:a)+'"'+(-1===parseInt(t)?' selected="selected"':"")+">All results</option>"}function getMetar(e){window.open("https://www.aviationweather.gov/metar/data?ids="+$("#form_icao").val()+"&format="+(e?"decoded":"raw")+"&taf=on&layout=off&hours="+$("#form_hours").val(),"popMETAR"+e,"scrollbars=1,resizable=1,location=1")}function getPagingOptions(e,t,a){var o="";pages=e/t;for(var r=0;r<pages;r++)o+='<option value="'+r+'"'+(parseInt(a)===r?' selected="selected"':"")+">"+(1+r*t)+"-"+(e<(r+1)*t?e:(r+1)*t)+"</option>";return o}function initSignalsForm(e,t){$(document).ready(function(){setFormPagingActions(),setFormPersonaliseAction(),setFormOffsetsAction(),setFormRangeAction(),setFormRangeUnitsDefault(),setFormSortbyAction(),setFormSortZaAction(),setFormShowModeAction(),setFormTypesStyles(),setFormTypesDefault(),setFormTypesAllAction(),setFormCountryAction(),setFormAdminAction(),setFormRegionAction(),setFormRwwFocusAction(),setFormStatesLabelLink(),setFormCountriesLabelLink(),setFormListenerInvertDefault(),setFormHeardInModDefault(),setFormListenerOptionsStyle(),setFormDatePickers(),setFormCollapseSections(),setFormResetAction("signals"),setColumnSortActions(),setColumnSortedClass(),setExternalLinks(),setFormPagingStatus(e,t),scrollToResults()})}function isValidEmail(e){return/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/.test(e)}function popup(e){var t,a,o,r,s,i,n=[];for(i=e.split("/").reverse(),a=0;a<=2;a++)$.isNumeric(i[a])?(o=i[a],n.push("[id]")):n.push(i[a]);return["rna","reu","rww"].includes(n[2])&&n.pop(),n.reverse(),r=n.join("_").replace(",","_"),void 0===popWinSpecs[r]?(alert("Unhandled mode "+r),!1):(s=r.replace("[id]",o),(t=window.open(e,s,popWinSpecs[r]))?t.focus():alert("ERROR:\n\nThis site tried to open a popup window\nbut was prevented from doing so.\n\nPlease disable any popup blockers you may\nhave enabled for this site."),!1)}function scrollToResults(){""!==$("#form_show").val()&&$([document.documentElement,document.body]).animate({scrollTop:$("#tabs").offset().top-20},500)}function setClippedCellTitles(){$("td.clipped").each(function(){$(this).attr("title",$(this).text().trim())})}function setColumnSortActions(){$("table.results thead tr th[id]").each(function(){$(this).click(function(){var e=this.id.split("|")[0],t=this.id.split("|")[1];$(this).hasClass("sorted")&&(t="a"===$("#form_order").val()?"d":"a"),$("#form_sort").val(e),$("#form_order").val(t),$('form[name="form"]').submit()})})}function setColumnSortedClass(){$("table.results thead tr th").each(function(){this.id.split("|")[0]===$("#form_sort").val()&&($(this).append("d"===$("#form_order").val()?" &#9662;":" &#9652;"),$(this).addClass("sorted"))})}function setEmailLinks(){$("a[data-contact]").each(function(){var e=$(this).attr("data-contact").split("").reverse().join("").trim().replace("#","@");$(this).attr("href",e),$(this).removeAttr("data-contact")})}function setEqualHeight(e,t){if(!$(e).height())return window.setTimeout(function(){setEqualHeight(e,t)},100);$(t).height($(e).height()),$(t).show(),$(t).height($(e).height())}function setExternalLinks(){$('a[rel="external"]').attr("target","_blank"),$("a[data-popup]").click(function(){if(1===$(this).data("popup"))return popup(this.href);var e=$(this).data("popup").split("|");return window.open(this.href,e[0],e[1]),!1}),$("a[data-append]").click(function(){var t,e,a,o;return t=$(this).find("span").html(),e="itu"===$(this).data("append")?"#form_countries":"#form_states",o=(a=window.opener.$(e)).val().split(" "),-1!==$.inArray(t,o)?o=o.filter(function(e){return e!=t}):o.push(t),a.val(Array.from(new Set(o)).sort().join(" ").trim()),!1}).attr("title",msg.data_append),$("a[data-set]").click(function(){var e,t,a,o;switch(e=$(this).text(),$(this).data("set")){case"khz":t=["#form_khz_1","#form_khz_2"];break;case"itu":t=["#form_countries"];break;case"sp":t=["#form_states"]}for(o in t)(a=$(t[o])).val()===e?a.val(""):a.val(e);return $('form[name="form"]').submit(),!1}).attr("title",msg.data_set),$("a[data-gsq]").click(function(){var e="map_"+$(this).data("gsq");return window.open(this.href,e,"scrollbars=1,resizable=1,width=1024,height=800"),!1}).each(function(){$(this).attr("href","./signals/"+$(this).data("gsq")+"/map")}).attr("title",msg.s_map_eu).attr("class","hover"),$("a[data-signal-map-eu]").click(function(){var e="map_"+$(this).data("signal-map-eu");return window.open(this.href,e,"scrollbars=1,resizable=1,width=1040,height=800"),!1}).each(function(){$(this).attr("href","./signals/"+$(this).data("signal-map-eu")+"/map/eu")}).attr("title",msg.s_map_eu).attr("class","hover"),$("a[data-signal-map-na]").click(function(){var e="map_"+$(this).data("signal-map-na");return window.open(this.href,e,"scrollbars=1,resizable=1,width=1040,height=800"),!1}).each(function(){$(this).attr("href","./signals/"+$(this).data("signal-map-na")+"/map/na")}).attr("title",msg.s_map_na).attr("class","hover"),$("area[data-map]").attr("shape","circle").mouseover(function(){$("#listener_"+$(this).data("map")).css({backgroundColor:"#ffff00"}).trigger("mouseenter")}).mouseout(function(){$("#listener_"+$(this).data("map")).css({backgroundColor:""}).trigger("mouseleave")}).each(function(){$(this).attr("title",$(this).attr("alt"))}),$("tr[data-map]").mouseover(function(){var e=$(this).data("map").split("|"),t=$("#rx_map").width()/$("#rx_map")[0].naturalWidth;$("#point_here").show().css({left:e[0]*t-5+"px",top:e[1]*t-5+"px"})}).mouseout(function(){$("#point_here").hide()}),$("tr[data-map] a").click(function(){var e="listeners_"+$(this).data("map");return window.open(this.href,e,popWinSpecs["listeners_[id]"]),!1})}function setFormCollapseSections(){$("#section_loggings legend").click(function(){$(this).parent().find("fieldset").toggle(),$(this).find("span").toggle()}),$("#section_customise legend").click(function(){$(this).parent().find("fieldset").toggle(),$(this).find("span").toggle()})}function setAwardsActions(){var e,t;for(e in all_sections)t=all_sections[e],$("#toggle_"+t).css({cursor:"pointer"}).prop("title",msg.show_hide).click(function(){$("#"+this.id.replace("toggle_","")).toggle(),$(this).find("span").toggle()}).find("span").css({"font-size":"120%"});$("#all_0").click(function(){return setAwardsShowHideAll(0),!1}),$("#all_1").click(function(){return setAwardsShowHideAll(1),!1}),$("#form_email").change(function(){isValidEmail($("#form_email").val())?$("#form_submit").removeAttr("disabled"):$("#form_submit").attr("disabled","disabled")}),$("#form_done").click(function(){location.replace(location.protocol+"//"+location.host+location.pathname)}),$("#form_body").val(msg.cart_none),$(".cart").each(function(){$(this).html('<span><img src="'+base_image+'/icon_cart.gif" alt="'+msg.no+'" title=""/><img style="display: none" src="'+base_image+'/icon_cart_added.gif" alt="'+msg.yes+'" /></span>')}),$(".cart span").click(function(){var e=$(this).parent();toggleAward(e.attr("id")),e.find("img").toggle()}),$("#form_submit").click(function(){var e=msg.cart_conf_1+"\n"+msg.cart_conf_2+"\n\n"+msg.cart_conf_3+"\n"+msg.cart_conf_4;if(!confirm(e))return alert(msg.cancelled),!1})}function toggleAward(e){var a,t,o,r;if(-1===(o=$.inArray(e,cart))?cart.push(e):cart.splice(o,1),cart=cart.sort(),r=msg.cart_none,cart.length){for(t in a=[],cart)a.push(cart[t].split("-")[0]);a=$.grep(a,function(e,t){return $.inArray(e,a)===t}),r=msg.cart_1+"\n"+msg.cart_2.padEnd(8," ")+award.admin+"\n"+msg.cart_3.padEnd(8," ")+award.from+"\n"+msg.cart_4.padEnd(8," ")+award.url+"/"+a.join(",")+"\n\n"+msg.cart_5+"\n"+msg.cart_6+"\n\n * "+cart.join("\n * ")+"\n\n"+msg.cart_7+"\n"+award.name}$("#form_awards").val(cart.join(",")),$("#form_filter").val(a.join(",")),$("#form_body").val(r),cart.length&&isValidEmail($("#form_email").val())?$("#form_submit").removeAttr("disabled"):$("#form_submit").attr("disabled","disabled")}function setAwardsShowHideAll(e){var t;for(t in all_sections)e?($("#"+all_sections[t]).show(),$("#toggle_"+all_sections[t]).find("span:eq(0)").hide(),$("#toggle_"+all_sections[t]).find("span:eq(1)").show()):($("#"+all_sections[t]).hide(),$("#toggle_"+all_sections[t]).find("span:eq(0)").show(),$("#toggle_"+all_sections[t]).find("span:eq(1)").hide())}function setFormCountryAction(e){(e=void 0===e||e)?$("select#form_country").change(function(){formSubmit()}):$("select#form_country").off("change")}function setFormCountriesLabelLink(){var e=$('label[for="form_countries"]');e.html('<a href="countries/*" data-popup="1">'+e.html()+"</a>")}function setFormStatesLabelLink(){var e=$('label[for="form_states"]');e.html('<a href="states/*" data-popup="1">'+e.html()+"</a>")}function setFormDatePickers(){$.datepicker.setDefaults({changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",yearRange:"1980:+0"}),$(".js-datepicker").datepicker({})}function setFormHeardInModDefault(){0===$("fieldset#form_heard_in_mod div :radio:checked").length&&$('fieldset#form_heard_in_mod div :radio[value="any"]').prop("checked",!0)}function setFormListenerInvertDefault(){0===$("fieldset#form_listener_invert div :radio:checked").length&&$("fieldset#form_listener_invert div :radio[value=0]").prop("checked",!0)}function setFormListenerOptionsStyle(){$("#form_listener").children().each(function(){""===$(this).val()?$(this).addClass("all"):". "===$(this).text().substr(0,2)?($(this).text("Â "+$(this).text().substr(1)),$(this).addClass("secondaryQth")):$(this).addClass("primaryQth")})}function setFormPagingActions(){var e=$("#form_filter"),t=$("#form_prev"),a=$("#form_next"),o=$("#form_limit");o.length&&(o[0].outerHTML='<select id="form_limit" name="form[limit]" required="required">'+getLimitOptions(paging.total,o.val(),paging.limit)+"</select>",o=$("#form_limit"));var s=$("#form_page");s.length&&(s[0].outerHTML='<label class="sr-only" for="form_page">Page Control</label>\n<select id="form_page" name="form[page]" style="display:none">'+getPagingOptions(paging.total,o.val(),paging.page)+"</select>",s=$("#form_page"));var r=$("#form_page option");"-1"!==o.val()&&(t.show(),a.show(),s.show()),o.change(function(){var e=$('form[name="form"]'),t=$("#form_limit"),a=$("#form_page option"),o=$("#form_prev"),r=$("#form_next");a.eq(0).prop("selected",!0),s.prop("selectedIndex",0),"-1"!==t.val()?(o.show(),r.show(),s.show(),a.eq(0).prop("text","1-"+t.val()),o.prop("disabled","disabled"),r.prop("disabled","disabled")):(s.hide(),o.hide(),r.hide()),s.prop("selectedIndex",0),e.submit()}),0<paging.page?t.click(function(){var e=$('form[name="form"]'),t=$("#form_page"),a=$("#form_page option"),o=$("#form_prev"),r=$("#form_next");return o.prop("disabled","disabled"),r.prop("disabled","disabled"),a.eq(paging.page-1).prop("selected",!0),t.prop("selectedIndex",paging.page-1),e.submit(),!1}):t.prop("disabled","disabled"),paging.page+1<r.length?a.click(function(){var e=$('form[name="form"]'),t=$("#form_page"),a=$("#form_page option"),o=$("#form_prev"),r=$("#form_next");return o.prop("disabled","disabled"),r.prop("disabled","disabled"),a.eq(paging.page+1).prop("selected",!0),t.prop("selectedIndex",paging.page+1),e.submit(),!1}):a.prop("disabled","disabled"),s.change(function(){var e=$('form[name="form"]'),t=$("#form_prev"),a=$("#form_next");t.prop("disabled","disabled"),a.prop("disabled","disabled"),e.submit()}),e.change(function(){var e=$('form[name="form"]'),t=$("#form_page"),a=$("#form_page option"),o=$("#form_prev"),r=$("#form_next");a.eq(0).prop("selected",!0),t.prop("selectedIndex",0),o.prop("disabled","disabled"),r.prop("disabled","disabled"),e.submit()})}function setFormPagingStatus(e,t){$("#form_paging_status").html(e.replace("%s",t.toLocaleString()))}function setFormPersonaliseAction(e){(e=void 0===e||e)?$("#form_personalise").change(function(){var e=$("#form_personalise option:selected").text(),t=(2===e.split("|").length?e.split("|")[1]:"").trim();$("#form_range_gsq").val(t),$("#form_range_gsq").trigger("keyup"),$('form[name="form"]').submit()}):$("#form_personalise").off("change")}function setFormOffsetsAction(e){(e=void 0===e||e)?$("#form_offsets").change(function(){formSubmit()}):$("#form_offsets").off("change")}function setFormRangeAction(){$("#form_range_gsq").on("keyup",function(){var e=$("#form_range_gsq").val().length<6;$("#form_range_min").attr("disabled",e),$("#form_range_max").attr("disabled",e)}),$("#form_range_min").on("keyup",function(){var e=0===$("#form_range_min").val().length&&0===$("#form_range_max").val().length;$("#form_range_units").attr("disabled",e)}),$("#form_dx_max").on("keyup",function(){var e=0===$("#form_range_min").val().length&&0===$("#form_range_max").val().length;$("#form_range_units").attr("disabled",e)}),$("#form_range_gsq").trigger("keyup"),$("#form_range_min").trigger("keyup")}function setFormRangeUnitsDefault(){0===$("fieldset#form_range_units div :radio:checked").length&&$("fieldset#form_range_units div :radio[value=km]").prop("checked",!0)}function setFormAdminAction(e){(e=void 0===e||e)?$("select#form_admin_mode").change(function(){formSubmit()}):$("select#form_admin_mode").off("change")}function setFormHasMapPosAction(e){(e=void 0===e||e)?$("select#form_has_map_pos").change(function(){formSubmit()}):$("select#form_has_map_pos").off("change")}function setFormRegionAction(e){(e=void 0===e||e)?$("select#form_region").change(function(){formSubmit()}):$("select#form_region").off("change")}function setFormRwwFocusAction(e){(e=void 0===e||e)?$("select#form_rww_focus").change(function(){formSubmit()}):$("select#form_rww_focus").off("change")}function setFormResetAction(e){switch(e){case"signals":$('button[type="reset"]').click(function(){return setFormAdminAction(!1),setFormRegionAction(!1),setFormRwwFocusAction(!1),setFormOffsetsAction(!1),setFormPersonaliseAction(!1),$("#form_show").val(""),$("#form_types div :checkbox").prop("checked",!1),$("#form_types div :checkbox[value=type_NDB]").prop("checked",!0),$("#form_call").val(""),$("#form_khz_1").val(""),$("#form_khz_2").val(""),$("#form_channels").prop("selectedIndex",0),$("#form_active").prop("selectedIndex",0),$("#form_personalise").prop("selectedIndex",0),$("#form_offsets").prop("selectedIndex",0),$("#form_states").val(""),$("#form_sp_itu_clause").prop("selectedIndex",0),$("#form_countries").val(""),$("#form_region").prop("selectedIndex",0),$("#form_rww_focus").prop("selectedIndex",0),$("#form_gsq").val(""),$("#form_range_gsq").val(""),$("#form_range_min").val(""),$("#form_range_max").val(""),$("#form_range_units_0").prop("checked",1),$("#form_range_gsq").trigger("keyup"),$("#form_range_min").trigger("keyup"),$("#form_listener").val([]),$("#form_listener_invert_0").prop("checked",1),$("#form_heard_in").val(""),$("#form_heard_in_mod_0").prop("checked",1),$("#form_logged_date_1").val(""),$("#form_logged_date_2").val(""),$("#form_logged_first_1").val(""),$("#form_logged_first_2").val(""),$("#form_logged_last_1").val(""),$("#form_logged_last_2").val(""),$("#form_admin_mode").prop("selectedIndex",0),setFormPersonaliseAction(!0),setFormOffsetsAction(!0),setFormAdminAction(!0),setFormRegionAction(!0),setFormRwwFocusAction(!0),formSubmit(),!1});break;case"listeners":$('button[type="reset"]').click(function(){return $("fieldset#form_types div :checkbox").prop("checked",!1),$("fieldset#form_types div :checkbox[value=type_NDB]").prop("checked",!0),$("#form_filter").val(""),setFormCountryAction(!1),setFormRegionAction(!1),setFormRwwFocusAction(!1),setFormHasMapPosAction(!1),$("select#form_region").prop("selectedIndex",0),$("select#form_country").prop("selectedIndex",0),$("select#form_has_map_pos").prop("selectedIndex",0),setFormCountryAction(!0),setFormRegionAction(!0),setFormRwwFocusAction(!0),setFormHasMapPosAction(!0),formSubmit(),!1})}}function formSubmit(){$("#form_clear").prop("disabled","disabled"),$("#form_submit").click().prop("disabled","disabled")}function setFormShowModeAction(){$("#seeklist_paper").change(function(){$("#form_paper").val($("#seeklist_paper option:selected").val()),formSubmit()})}function setFormSortbyAction(){$("select#form_sortby").change(function(){var e=$("#form_sortby option:selected").val();$("#form_sort").val(e.split("|")[0]),$("#form_order").val(e.split("|")[1]),$("#form_za").prop("checked","d"===e.split("|")[1]),formSubmit()})}function setFormSortZaAction(){$("input#form_za").change(function(){$("#form_order").val($("input#form_za").prop("checked")?"d":"a"),formSubmit()})}function setFormTypesStyles(){$("fieldset#form_types div input").each(function(){$(this).parent().attr("class",$(this).attr("class"))})}function setFormTypesDefault(){0===$("fieldset#form_types div :checkbox:checked").length&&$("fieldset#form_types div :checkbox[value=type_NDB]").prop("checked",!0)}function setFormTypesAllAction(){$("fieldset#form_types div :checkbox[value=type_ALL]").click(function(){$("fieldset#form_types div :checkbox").prop("checked",$(this).prop("checked"))})}function strip_tags(e,a){return a=(((a||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join(""),e.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(e,t){return-1<a.indexOf("<"+t.toLowerCase()+">")?e:""})}function initListenerSignalsMap(){var e,t,a;for(a in TxtOverlay=initMapsTxtOverlay(),map=new google.maps.Map(document.getElementById("map"),{center:{lat:listener.lat,lng:listener.lng},scaleControl:!0,zoomControl:!0,zoom:2}),layers.qth=new google.maps.Marker({position:{lat:listener.lat,lng:listener.lng},map:map,icon:{scaledSize:new google.maps.Size(30,30),url:"//maps.google.com/mapfiles/kml/pushpin/red-pushpin.png"},title:listener.name}),e=new google.maps.InfoWindow({content:"<h2>"+listener.name+"</h2><p>"+listener.qth+"</p>"}),layers.qth.addListener("click",function(){e.open(map,layers.qth)}),showGrid(map,layers,"gridLabel"),listener.types)t=listener.types[a],layers[t+"_0"]=new google.maps.KmlLayer({url:listener.source+"/"+t+"/0?v=a"+listener.logLatest+"_"+(new Date).toJSON().substring(0,10),preserveViewport:!0,map:map}),layers[t+"_1"]=new google.maps.KmlLayer({url:listener.source+"/"+t+"/1?v=a"+listener.logLatest,preserveViewport:!0,map:map});function o(e){var t;if(!Array.isArray(layers[e]))return t=null!==layers[e].getMap(),void layers[e].setMap(t?null:map);for(var a in t=null!==layers[e][0].getMap(),layers[e])layers[e][a].setMap(t?null:map)}google.maps.event.addDomListener(document.getElementById("layer_grid"),"click",function(){o("grid")}),google.maps.event.addDomListener(document.getElementById("layer_inactive"),"click",function(){!function(){for(a in listener.types)t=listener.types[a],document.getElementById("layer_"+t).checked&&(document.getElementById("layer_inactive").checked?layers[t+"_0"].setMap(map):layers[t+"_0"].setMap(null))}()}),google.maps.event.addDomListener(document.getElementById("layer_qth"),"click",function(){o("qth")}),listener.types.forEach(function(t){google.maps.event.addDomListener(document.getElementById("layer_"+t),"click",function(){var e;null==layers[(e=t)+"_1"].getMap()?(layers[e+"_1"].setMap(map),document.getElementById("layer_inactive").checked?layers[e+"_0"].setMap(map):layers[e+"_0"].setMap(null)):(layers[e+"_0"].setMap(null),layers[e+"_1"].setMap(null))})})}var LMap={markerGroups:null,init:function(){TxtOverlay=initMapsTxtOverlay(),(map=new google.maps.Map(document.getElementById("map"),{center:{lat:center.lat,lng:center.lon},scaleControl:!0,zoomControl:!0,zoom:2})).fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(box[0].lat,box[0].lon),new google.maps.LatLng(box[1].lat,box[1].lon))),$("#layer_grid").click(function(){LMap.toggleGrid()}),$("#layer_primary").click(function(){LMap.togglePrimary()}),$("#layer_secondary").click(function(){LMap.toggleSecondary()}),LMap.showGrid("gridLabel"),LMap.showMarkers(),setExternalLinks(),setClippedCellTitles()},showGrid:function(e){return showGrid(map,layers,e)},showMarkers:function(){var e,t,a,o,r,s;if(listeners){for(t in LMap.markerGroups=new google.maps.MVCObject,LMap.markerGroups.set("primary",map),LMap.markerGroups.set("secondary",map),LMap.markerGroups.set("highlight",map),o={url:base_image+"/map_point3.gif",origin:new google.maps.Point(0,0),anchor:new google.maps.Point(5,5)},r={url:base_image+"/map_point4.gif",origin:new google.maps.Point(0,0),anchor:new google.maps.Point(5,5)},a={url:base_image+"/map_point_here.gif",origin:new google.maps.Point(0,0),anchor:new google.maps.Point(6,6)},e="",listeners)l=listeners[t],e+='<tr id="listener_'+l.id+'" data-gmap="'+l.lat+"|"+l.lon+'"><td class="text-nowrap"><a href="'+base_url+"listeners/"+l.id+'" class="'+(l.pri?"pri":"sec")+'" data-popup="1">'+l.name+"</a></td><td>"+l.qth+"</td><td>"+l.sp+"</td><td>"+l.itu+"</td></tr>",(s=new google.maps.Marker({position:new google.maps.LatLng(l.lat,l.lon),id:"point_"+l.id,title:decodeHtmlEntities(l.name)+": "+decodeHtmlEntities(l.qth)+(l.sp?", "+l.sp:"")+", "+l.itu,icon:l.pri?o:r})).bindTo("map",LMap.markerGroups,l.pri?"primary":"secondary"),markers.push(s);for(t in markers)markers[t].addListener("mouseover",function(){$("#listener_"+this.id.split("_")[1]).css("background","#ffff00")}),markers[t].addListener("mouseout",function(){$("#listener_"+this.id.split("_")[1]).css("background","")}),markers[t].addListener("click",function(){$("#listener_"+this.id.split("_")[1]).find("a").trigger("click")});$(".results tbody").append(e),$("tr[data-gmap]").mouseover(function(){var e=$(this).data("gmap").split("|");highlight=new google.maps.Marker({position:new google.maps.LatLng(e[0],e[1]),map:map,icon:a})}).mouseout(function(){highlight.setMap(null)}),$(".no-results").hide(),$(".results").show()}},toggle:function(e){var t,a;if(!Array.isArray(layers[e]))return t=null!==layers[e].getMap(),void layers[e].setMap(t?null:map);for(a in t=null!==layers[e][0].getMap(),layers[e])layers[e][a].setMap(t?null:map)},toggleGrid:function(){LMap.toggle("grid")},togglePrimary:function(){LMap.markerGroups.set("primary",$("#layer_primary").prop("checked")?map:null)},toggleSecondary:function(){LMap.markerGroups.set("secondary",$("#layer_secondary").prop("checked")?map:null)}};function showGrid(e,t,a){var o,r,s;for(r=0;r<180;r+=10)t.grid.push(new google.maps.Polyline({path:[{lat:r-90,lng:-180},{lat:r-90,lng:0},{lat:r-90,lng:180}],geodesic:!1,strokeColor:gridColor,strokeOpacity:gridOpacity,strokeWeight:.5}));for(s=0;s<360;s+=20)t.grid.push(new google.maps.Polyline({path:[{lat:85.05,lng:s},{lat:-85.05,lng:s}],geodesic:!1,strokeColor:gridColor,strokeOpacity:gridOpacity,strokeWeight:.5}));for(r=10;r<170;r+=10)for(s=0;s<360;s+=20)t.grid.push(new TxtOverlay(new google.maps.LatLng(r-90+5,s-180+10),String.fromCharCode(s/20+65)+String.fromCharCode(r/10+65),a,e));for(o in t.grid)t.grid[o].setMap(e)}function initMapsTxtOverlay(){function e(e,t,a,o){this.pos=e,this.txt_=t,this.cls_=a,this.map_=o,this.div_=null,this.setMap(o)}return(e.prototype=new google.maps.OverlayView).onAdd=function(){var e,t;(e=document.createElement("DIV")).className=this.cls_,e.innerHTML=this.txt_,this.div_=e,t=this.getProjection().fromLatLngToDivPixel(this.pos),e.style.left=t.x+"px",e.style.top=t.y+"px",this.getPanes().floatPane.appendChild(e)},e.prototype.draw=function(){var e,t;t=this.getProjection().fromLatLngToDivPixel(this.pos),(e=this.div_).style.left=t.x+"px",e.style.top=t.y+"px"},e.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},e}var LocatorMap={init:function(t,a){if(!$("#rx_map").height())return window.setTimeout(function(){LocatorMap.init(t,a)},100);$("#rx_map").on("click",function(e){var t=parseInt(e.pageX-$(this).offset().left),a=parseInt(e.pageY-$(this).offset().top);LocatorMap.setPos(t,a),$("#form_mapX").val(t),$("#form_mapY").val(a)}),$("#form_mapX").change(function(e){t=parseInt($("#form_mapX").val()),a=parseInt($("#form_mapY").val()),LocatorMap.setPos(t,a)}),$("#form_mapY").change(function(e){t=parseInt($("#form_mapX").val()),a=parseInt($("#form_mapY").val()),LocatorMap.setPos(t,a)}),$("#x_sub").click(function(e){var t=parseInt($("#form_mapX").val());0<t&&$("#form_mapX").val(t-1).trigger("change")}),$("#x_add").click(function(e){var t=parseInt($("#form_mapX").val());$("#form_mapX").val(t+1).trigger("change")}),$("#y_sub").click(function(e){var t=parseInt($("#form_mapY").val());0<t&&$("#form_mapY").val(t-1).trigger("change")}),$("#y_add").click(function(e){var t=parseInt($("#form_mapY").val());$("#form_mapY").val(t+1).trigger("change")}),$("#form_reset").click(function(e){e.preventDefault(),form=e.toElement.form,form.reset(),t=$("#form_mapX").val(),a=$("#form_mapY").val(),LocatorMap.setPos(t,a)}),LocatorMap.setPos(t,a),$("#form").show()},setPos:function(e,t){0===e&&0===t||$("#cursor").css({left:e-10+"px",top:t-10+"px",display:"block"})}},signalsMap={map:null,icons:{},infoWindow:null,items:[],options:{},init:function(){TxtOverlay=initMapsTxtOverlay(),signalsMap.items=signals;var e=["dgps","dsc","hambcn","navtex","ndb","time","other"],t=[0,1];for(var a in e)for(var o in t){var r=base_image+"/pins/"+e[a]+"_"+t[o]+".png";signalsMap.icons[e[a]+"_"+t[o]]=new google.maps.MarkerImage(r,new google.maps.Size(12,20))}signalsMap.options={zoom:2,center:new google.maps.LatLng(20,0),mapTypeId:google.maps.MapTypeId.ROADMAP},signalsMap.map=new google.maps.Map(document.getElementById("map"),signalsMap.options),signalsMap.infoWindow=new google.maps.InfoWindow,signalsMap.showMarkers(),showGrid(signalsMap.map,layers,"gridLabel")},markerClickFunction:function(o,r){return function(e){e.cancelBubble=!0,e.returnValue=!1,e.stopPropagation&&(e.stopPropagation(),e.preventDefault());var t=o.khz+" "+o.call+" ",a='<div class="map_info">  <h3><a href="./rna/signal_info/'+o.id+'" target="_blank">'+t+'</a></h3>  <table class="info-body">'+(void 0!==o.logged?"    <tr><th>Received</th><td><b>"+(o.logged?"Yes":"No")+"</b></td></tr>":"")+"    <tr><th>ID</th><td>"+o.call+"</td></tr>    <tr><th>KHz</th><td>"+o.khz+"</td></tr>    <tr><th>Type</th><td>"+o.type+"</td></tr>"+("0"!==o.pwr?"    <tr><th>Power</th><td>"+o.pwr+"W</td></tr>":"")+"    <tr><th>'Name' / QTH</th><td>"+o.qth+(o.sp?", "+o.sp:"")+", "+o.itu+"</td></tr>"+(o.gsq?'    <tr><th>GSQ</th><td><a href="." onclick="popup_map('+o.id+","+o.lat+","+o.lon+');return false;" title="Show map (accuracy limited to nearest Grid Square)">'+o.gsq+"</a></td></tr>":"")+"    <tr><th>Lat / Lon</th><td>"+o.lat+", "+o.lon+"</td></tr>"+(o.usb||o.lsb?"    <tr><th>Sidebands</th><td>"+(o.lsb?"LSB: "+o.lsb:"")+(o.usb?(o.lsb?", ":"")+" USB: "+o.usb:"")+"</td></tr>":"")+(o.sec||o.fmt?"    <tr><th>Secs / Format</th><td>"+(o.sec?o.sec+" sec":"")+(o.sec&&o.fmt?", ":"")+o.fmt+"</td></tr>":"")+"    <tr><th>Last Logged</th><td>"+o.heard+"</td></tr>    <tr><th>Heard In</th><td>"+o.heard_in+"</td></tr>  </table></div>";signalsMap.infoWindow.setContent(a),signalsMap.infoWindow.setPosition(r),signalsMap.infoWindow.open(signalsMap.map)}},showMarkers:function(){var e,t,a,o,r,s,i,n,l;if(signalsMap.markers=[],s=document.getElementById("markerlist"),0!==signalsMap.items.length)for(s.innerHTML="",t=0;t<signalsMap.items.length;t++)l="<b>"+(void 0!==(i=signalsMap.items[t]).logged?(i.logged?"&#9745;":"&#9744;")+" ":"")+i.khz+" "+i.call+"</b> "+i.qth+(i.sp?", "+i.sp:"")+", "+i.itu,a=document.createElement("DIV"),(n=document.createElement("A")).href="#",n.className="title type_"+i.className,n.innerHTML=l,void 0!==i.logged&&i.logged&&(a.className="logged",a.title="Received"),a.appendChild(n),s.appendChild(a),o=new google.maps.LatLng(i.lat,i.lon),r=new google.maps.Marker({title:strip_tags(i.khz+" "+i.call),position:o,icon:signalsMap.icons[i.icon+"_"+(i.active?1:0)]}),e=signalsMap.markerClickFunction(i,o),google.maps.event.addListener(r,"click",e),google.maps.event.addDomListener(n,"click",e),r.setMap(signalsMap.map)}};